generator client {
  provider = "prisma-client-js"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  ADVOGADO
  SECRETARIA
  FINANCEIRO
  CLIENTE
}

enum TenantStatus {
  ACTIVE
  SUSPENDED
  CANCELLED
}

enum TipoPessoa {
  FISICA
  JURIDICA
}

enum TipoEndereco {
  MATRIZ
  FILIAL
  ESCRITORIO
}

enum ProcessoStatus {
  RASCUNHO
  EM_ANDAMENTO
  SUSPENSO
  ENCERRADO
  ARQUIVADO
}

enum MovimentacaoTipo {
  ANDAMENTO
  PRAZO
  INTIMACAO
  AUDIENCIA
  ANEXO
  OUTRO
}

enum ContratoStatus {
  RASCUNHO
  ATIVO
  SUSPENSO
  ENCERRADO
  CANCELADO
}

enum TarefaStatus {
  PENDENTE
  EM_ANDAMENTO
  CONCLUIDA
  CANCELADA
}

enum TarefaPrioridade {
  BAIXA
  MEDIA
  ALTA
  CRITICA
}

enum NotificacaoTipo {
  SISTEMA
  PRAZO
  DOCUMENTO
  MENSAGEM
  FINANCEIRO
  OUTRO
}

enum NotificacaoPrioridade {
  BAIXA
  MEDIA
  ALTA
  CRITICA
}

enum NotificacaoStatus {
  NAO_LIDA
  LIDA
  ARQUIVADA
}

enum NotificacaoCanal {
  IN_APP
  EMAIL
  SMS
  WHATSAPP
  TELEGRAM
  PUSH
}

enum TenantPermission {
  CONFIGURACOES_ESCRITORIO
  EQUIPE_GERENCIAR
  FINANCEIRO_GERENCIAR
}

enum SubscriptionStatus {
  TRIAL
  ATIVA
  INADIMPLENTE
  CANCELADA
}

enum InvoiceStatus {
  RASCUNHO
  ABERTA
  PAGA
  VENCIDA
  CANCELADA
}

enum PaymentStatus {
  PENDENTE
  PROCESSANDO
  PAGO
  FALHOU
  ESTORNADO
}

enum DocumentoOrigem {
  CLIENTE
  ESCRITORIO
  SISTEMA
}

enum ProcuracaoEmitidaPor {
  ESCRITORIO
  ADVOGADO
}

enum ProcuracaoStatus {
  RASCUNHO
  PENDENTE_ASSINATURA
  VIGENTE
  REVOGADA
  EXPIRADA
}

enum EventoTipo {
  AUDIENCIA
  REUNIAO
  CONSULTA
  PRAZO
  LEMBRETE
  OUTRO
}

enum EventoStatus {
  AGENDADO
  CONFIRMADO
  CANCELADO
  REALIZADO
  ADIADO
}

enum EventoRecorrencia {
  NENHUMA
  DIARIA
  SEMANAL
  MENSAL
  ANUAL
}

enum DocumentoAssinaturaStatus {
  PENDENTE
  ASSINADO
  REJEITADO
  EXPIRADO
  CANCELADO
}

enum TipoComissao {
  HONORARIOS
  ACAO_GANHA
  CUSTAS
  OUTROS
}

enum JuizStatus {
  ATIVO
  INATIVO
  APOSENTADO
  SUSPENSO
}

enum EspecialidadeJuridica {
  CIVIL
  CRIMINAL
  TRABALHISTA
  FAMILIA
  TRIBUTARIO
  ADMINISTRATIVO
  EMPRESARIAL
  CONSUMIDOR
  AMBIENTAL
  ELETORAL
  MILITAR
  PREVIDENCIARIO
  CONSTITUCIONAL
  INTERNACIONAL
  OUTROS
}

enum JuizNivel {
  JUIZ_SUBSTITUTO
  JUIZ_TITULAR
  DESEMBARGADOR
  MINISTRO
  OUTROS
}

model AreaProcesso {
  id        String   @id @default(cuid())
  tenantId  String?
  slug      String
  nome      String
  descricao String?
  ordem     Int?
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tenant    Tenant?    @relation(fields: [tenantId], references: [id], onDelete: SetNull)
  processos Processo[]

  @@unique([tenantId, slug])
  @@unique([slug])
  @@index([tenantId])
  @@index([nome])
}

model TipoContrato {
  id        String   @id @default(cuid())
  tenantId  String?
  slug      String
  nome      String
  descricao String?
  ordem     Int?
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tenant    Tenant?          @relation(fields: [tenantId], references: [id], onDelete: SetNull)
  contratos Contrato[]
  modelos   ModeloContrato[]

  @@unique([tenantId, slug])
  @@unique([slug])
  @@index([tenantId])
  @@index([nome])
}

model CategoriaTarefa {
  id        String   @id @default(cuid())
  tenantId  String?
  slug      String
  nome      String
  descricao String?
  corHex    String?
  ordem     Int?
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tenant  Tenant?  @relation(fields: [tenantId], references: [id], onDelete: SetNull)
  tarefas Tarefa[]

  @@unique([tenantId, slug])
  @@unique([slug])
  @@index([tenantId])
  @@index([nome])
}

model Tenant {
  id                  String                 @id @default(cuid())
  name                String
  slug                String                 @unique
  domain              String?                @unique
  timezone            String                 @default("America/Sao_Paulo")
  status              TenantStatus           @default(ACTIVE)
  tipoPessoa          TipoPessoa             @default(JURIDICA)
  documento           String?
  razaoSocial         String?
  nomeFantasia        String?
  inscricaoEstadual   String?
  inscricaoMunicipal  String?
  email               String?
  telefone            String?
  createdAt           DateTime               @default(now())
  updatedAt           DateTime               @updatedAt
  branding            TenantBranding?
  usuarios            Usuario[]
  advogados           Advogado[]
  clientes            Cliente[]
  processos           Processo[]
  contratos           Contrato[]
  modelosContrato     ModeloContrato[]
  tarefas             Tarefa[]
  movimentacoes       MovimentacaoProcesso[]
  documentos          Documento[]
  juizes              Juiz[]
  tribunais           Tribunal[]
  areasProcesso       AreaProcesso[]
  tiposContrato       TipoContrato[]
  categoriasTarefa    CategoriaTarefa[]
  julgamentos         Julgamento[]
  analisesJuiz        AnaliseJuiz[]
  favoritosJuiz       FavoritoJuiz[]
  acessosJuiz         AcessoJuiz[]
  subscription        TenantSubscription?
  faturas             Fatura[]
  pagamentos          Pagamento[]
  auditLogs           AuditLog[]
  advogadoClientes    AdvogadoCliente[]
  processoDocumentos  ProcessoDocumento[]
  procuracoes         Procuracao[]
  procuracaoProcessos ProcuracaoProcesso[]
  procuracaoAdvogados ProcuracaoAdvogado[]
  enderecos           TenantEndereco[]
  notificacoes        Notificacao[]
  notificacoesUsuarios NotificacaoUsuario[]
  usuarioPermissoes   UsuarioPermissao[]
  eventos             Evento[]
  documentoAssinaturas DocumentoAssinatura[]

  @@index([status])
  @@unique([documento])
}

model TenantEndereco {
  id          String        @id @default(cuid())
  tenantId    String
  apelido     String
  tipo        TipoEndereco  @default(ESCRITORIO)
  principal   Boolean       @default(false)
  logradouro  String
  numero      String?
  complemento String?
  bairro      String?
  cidade      String
  estado      String
  cep         String?
  pais        String        @default("Brasil")
  telefone    String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, apelido])
  @@index([tenantId, principal])
}

model TenantBranding {
  id                 String   @id @default(cuid())
  tenantId           String   @unique
  tenant             Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  primaryColor       String?
  secondaryColor     String?
  accentColor        String?
  logoUrl            String?
  faviconUrl         String?
  loginBackgroundUrl String?
  emailFromName      String?
  emailFromAddress   String?
  customDomainText   String?
  settings           Json?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model Usuario {
  id                        String                 @id @default(cuid())
  tenantId                  String
  tenant                    Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  email                     String
  passwordHash              String?
  role                      UserRole               @default(SECRETARIA)
  firstName                 String?
  lastName                  String?
  phone                     String?
  avatarUrl                 String?
  active                    Boolean                @default(true)
  lastLoginAt               DateTime?
  createdAt                 DateTime               @default(now())
  updatedAt                 DateTime               @updatedAt
  advogado                  Advogado?
  tarefas                   Tarefa[]               @relation("TarefasResponsaveis")
  tarefasCriadas            Tarefa[]               @relation("TarefasCriadas")
  movimentacoesCriadas      MovimentacaoProcesso[] @relation("MovimentacaoCriador")
  documentos                Documento[]            @relation("DocumentoUploader")
  auditLogs                 AuditLog[]
  contratosResponsavel      Contrato[]             @relation("ContratoResponsavel")
  contratosCriados          Contrato[]             @relation("ContratoCriador")
  processoDocumentosCriados ProcessoDocumento[]    @relation("ProcessoDocumentoCriador")
  cliente                   Cliente?               @relation("UsuarioCliente")
  procuracoesCriadas        Procuracao[]           @relation("ProcuracaoCriador")
  notificacoesCriadas       Notificacao[]          @relation("NotificacaoCriador")
  notificacoesRecebidas     NotificacaoUsuario[]
  permissoes                UsuarioPermissao[]
  eventosCriados            Evento[]
  documentoAssinaturasCriadas DocumentoAssinatura[]
  julgamentosCriados        Julgamento[]       @relation("JulgamentoCriador")
  analisesJuizCriadas       AnaliseJuiz[]      @relation("AnaliseJuizCriador")
  favoritosJuiz             FavoritoJuiz[]
  acessosJuiz               AcessoJuiz[]

  @@unique([email, tenantId])
  @@index([role])
}

model Advogado {
  id             String               @id @default(cuid())
  tenantId       String
  usuarioId      String               @unique
  tenant         Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  usuario        Usuario              @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  oabNumero      String?
  oabUf          String?
  especialidades EspecialidadeJuridica[]
  bio            String?
  telefone       String?
  whatsapp       String?
  // Campos financeiros para comissões
  comissaoPadrao     Decimal?          @db.Decimal(5, 2) @default(0.00) // Percentual padrão (0-100)
  comissaoAcaoGanha  Decimal?          @db.Decimal(5, 2) @default(0.00) // Percentual em ações ganhas (0-100)
  comissaoHonorarios Decimal?          @db.Decimal(5, 2) @default(0.00) // Percentual em honorários (0-100)
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  clientes       AdvogadoCliente[]
  processos      Processo[]           @relation("ProcessoAdvogadoResponsavel")
  contratos      Contrato[]           @relation("ContratoAdvogado")
  procuracoes    ProcuracaoAdvogado[]
  eventos        Evento[]
  documentoAssinaturas DocumentoAssinatura[]
}

model Cliente {
  id                  String            @id @default(cuid())
  tenantId            String
  tenant              Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tipoPessoa          TipoPessoa
  nome                String
  documento           String?
  email               String?
  telefone            String?
  celular             String?
  dataNascimento      DateTime?
  inscricaoEstadual   String?
  responsavelNome     String?
  responsavelEmail    String?
  responsavelTelefone String?
  endereco            Json?
  observacoes         String?
  usuarioId           String?           @unique
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  processos           Processo[]
  contratos           Contrato[]
  documentos          Documento[]       @relation("DocumentoCliente")
  advogadoClientes    AdvogadoCliente[]
  tarefas             Tarefa[]          @relation("TarefaCliente")
  usuario             Usuario?          @relation("UsuarioCliente", fields: [usuarioId], references: [id], onDelete: SetNull)
  procuracoes         Procuracao[]
  eventos             Evento[]
  documentoAssinaturas DocumentoAssinatura[]

  @@index([nome])
  @@index([documento])
}

model AdvogadoCliente {
  id             String   @id @default(cuid())
  tenantId       String
  tenant         Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  advogadoId     String
  clienteId      String
  relacionamento String?
  createdAt      DateTime @default(now())

  advogado Advogado @relation(fields: [advogadoId], references: [id], onDelete: Cascade)
  cliente  Cliente  @relation(fields: [clienteId], references: [id], onDelete: Cascade)

  @@unique([advogadoId, clienteId])
  @@index([clienteId])
}

model Juiz {
  id                String            @id @default(cuid())
  tenantId          String?
  tribunalId        String?
  nome              String
  nomeCompleto      String?
  cpf               String?           @unique
  oab               String?
  email             String?
  telefone          String?
  endereco          String?
  cidade            String?
  estado            String?
  cep               String?
  dataNascimento    DateTime?
  dataPosse         DateTime?
  dataAposentadoria DateTime?
  status            JuizStatus        @default(ATIVO)
  nivel             JuizNivel         @default(JUIZ_TITULAR)
  especialidades    EspecialidadeJuridica[]
  vara              String?
  comarca           String?
  biografia         String?
  formacao          String?
  experiencia       String?
  premios           String?
  publicacoes       String?
  foto              String?
  website           String?
  linkedin          String?
  twitter           String?
  instagram         String?
  observacoes       String?
  isPublico         Boolean           @default(false) // Se pode ser compartilhado entre tenants
  isPremium         Boolean           @default(false) // Se é conteúdo premium
  precoAcesso       Decimal?          @db.Decimal(10, 2) // Preço para acesso premium
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  // Relacionamentos
  tenant            Tenant?           @relation(fields: [tenantId], references: [id], onDelete: SetNull)
  tribunal          Tribunal?         @relation(fields: [tribunalId], references: [id], onDelete: SetNull)
  processos         Processo[]
  julgamentos       Julgamento[]
  analises          AnaliseJuiz[]
  favoritos         FavoritoJuiz[]
  acessos           AcessoJuiz[]

  @@index([nome])
  @@index([tenantId])
  @@index([status])
  @@index([especialidades])
}

model Tribunal {
  id        String   @id @default(cuid())
  tenantId  String?
  nome      String
  sigla     String?
  esfera    String?
  uf        String?
  siteUrl   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tenant    Tenant?    @relation(fields: [tenantId], references: [id], onDelete: SetNull)
  processos Processo[]
  juizes    Juiz[]

  @@unique([nome, uf])
}

model Notificacao {
  id              String                 @id @default(cuid())
  tenantId        String
  titulo          String
  mensagem        String
  tipo            NotificacaoTipo        @default(SISTEMA)
  prioridade      NotificacaoPrioridade  @default(MEDIA)
  canais          NotificacaoCanal[]     @default([IN_APP])
  dados           Json?
  referenciaTipo  String?
  referenciaId    String?
  agendarPara     DateTime?
  expiracaoEm     DateTime?
  createdAt       DateTime               @default(now())
  createdById     String?
  updatedAt       DateTime               @updatedAt

  tenant          Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  createdBy       Usuario?               @relation("NotificacaoCriador", fields: [createdById], references: [id], onDelete: SetNull)
  destinos        NotificacaoUsuario[]

  @@index([tenantId, tipo])
  @@index([tenantId, prioridade])
  @@index([tenantId, agendarPara])
}

model NotificacaoUsuario {
  id             String             @id @default(cuid())
  notificacaoId  String
  tenantId       String
  usuarioId      String
  canal          NotificacaoCanal   @default(IN_APP)
  status         NotificacaoStatus  @default(NAO_LIDA)
  entregueEm     DateTime?
  lidoEm         DateTime?
  reabertoEm     DateTime?
  metadata       Json?
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt

  notificacao    Notificacao        @relation(fields: [notificacaoId], references: [id], onDelete: Cascade)
  tenant         Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  usuario        Usuario            @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([notificacaoId, usuarioId, canal])
  @@index([tenantId, usuarioId, status])
}

model UsuarioPermissao {
  id        String            @id @default(cuid())
  tenantId  String
  usuarioId String
  permissao TenantPermission
  createdAt DateTime          @default(now())

  tenant    Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  usuario   Usuario           @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([tenantId, usuarioId, permissao])
  @@index([tenantId, permissao])
}

model Processo {
  id                    String         @id @default(cuid())
  tenantId              String
  numero                String
  titulo                String?
  descricao             String?
  status                ProcessoStatus @default(RASCUNHO)
  areaId                String?
  classeProcessual      String?
  vara                  String?
  comarca               String?
  foro                  String?
  dataDistribuicao      DateTime?
  segredoJustica        Boolean        @default(false)
  valorCausa            Decimal?       @db.Decimal(14, 2)
  rito                  String?
  clienteId             String
  advogadoResponsavelId String?
  juizId                String?
  tribunalId            String?
  tags                  Json?
  prazoPrincipal        DateTime?
  numeroInterno         String?
  pastaCompartilhadaUrl String?
  createdAt             DateTime       @default(now())
  updatedAt             DateTime       @updatedAt

  tenant                Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  cliente               Cliente                @relation(fields: [clienteId], references: [id], onDelete: Cascade)
  advogadoResponsavel   Advogado?              @relation("ProcessoAdvogadoResponsavel", fields: [advogadoResponsavelId], references: [id], onDelete: SetNull)
  juiz                  Juiz?                  @relation(fields: [juizId], references: [id], onDelete: SetNull)
  tribunal              Tribunal?              @relation(fields: [tribunalId], references: [id], onDelete: SetNull)
  area                  AreaProcesso?          @relation(fields: [areaId], references: [id], onDelete: SetNull)
  movimentacoes         MovimentacaoProcesso[]
  tarefas               Tarefa[]
  documentos            Documento[]            @relation("DocumentoProcesso")
  documentosVinculados  ProcessoDocumento[]
  contratos             Contrato[]
  procuracoesVinculadas ProcuracaoProcesso[]
  eventos               Evento[]
  documentoAssinaturas  DocumentoAssinatura[]
  julgamentos           Julgamento[]

  @@unique([tenantId, numero])
  @@index([status])
  @@index([clienteId])
  @@index([areaId])
}

// Procuração é emitida pelo Escritório ou por um Advogado e é assinada pelo Cliente.
// Uma Procuração pode habilitar 1..N Advogados a atuarem em 1..N Processos.
// O acesso do advogado aos autos do processo é derivado do vínculo via Procuração.
model Procuracao {
  id                    String               @id @default(cuid())
  tenantId              String
  clienteId             String
  numero                String?
  arquivoUrl            String?
  observacoes           String?
  emitidaEm             DateTime?
  validaAte             DateTime?
  revogadaEm            DateTime?
  ativa                 Boolean              @default(true) // LEGADO: prefira usar 'status'
  status                ProcuracaoStatus     @default(RASCUNHO)
  assinadaPeloClienteEm DateTime?
  emitidaPor            ProcuracaoEmitidaPor @default(ESCRITORIO)
  createdById           String?
  createdAt             DateTime             @default(now())
  updatedAt             DateTime             @updatedAt

  tenant     Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  cliente    Cliente              @relation(fields: [clienteId], references: [id], onDelete: Cascade)
  createdBy  Usuario?             @relation("ProcuracaoCriador", fields: [createdById], references: [id], onDelete: SetNull)
  outorgados ProcuracaoAdvogado[]
  processos  ProcuracaoProcesso[]

  @@index([tenantId, clienteId])
  @@index([tenantId, ativa])
}

model ProcuracaoProcesso {
  id           String   @id @default(cuid())
  tenantId     String
  procuracaoId String
  processoId   String
  createdAt    DateTime @default(now())

  tenant     Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  procuracao Procuracao @relation(fields: [procuracaoId], references: [id], onDelete: Cascade)
  processo   Processo   @relation(fields: [processoId], references: [id], onDelete: Cascade)

  @@unique([procuracaoId, processoId])
  @@index([tenantId, processoId])
  @@index([tenantId, procuracaoId])
}

model ProcuracaoAdvogado {
  id           String   @id @default(cuid())
  tenantId     String
  procuracaoId String
  advogadoId   String
  createdAt    DateTime @default(now())

  tenant     Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  procuracao Procuracao @relation(fields: [procuracaoId], references: [id], onDelete: Cascade)
  advogado   Advogado   @relation(fields: [advogadoId], references: [id], onDelete: Cascade)

  @@unique([procuracaoId, advogadoId])
  @@index([tenantId, advogadoId])
  @@index([tenantId, procuracaoId])
}

model MovimentacaoProcesso {
  id               String            @id @default(cuid())
  tenantId         String
  processoId       String
  titulo           String
  descricao        String?
  tipo             MovimentacaoTipo?
  dataMovimentacao DateTime          @default(now())
  prazo            DateTime?
  criadoPorId      String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt

  tenant     Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  processo   Processo    @relation(fields: [processoId], references: [id], onDelete: Cascade)
  criadoPor  Usuario?    @relation("MovimentacaoCriador", fields: [criadoPorId], references: [id], onDelete: SetNull)
  documentos Documento[] @relation("MovimentacaoDocumentos")

  @@index([processoId])
  @@index([dataMovimentacao])
}

model Documento {
  id                 String          @id @default(cuid())
  tenantId           String
  nome               String
  tipo               String?
  descricao          String?
  url                String
  tamanhoBytes       Int?
  contentType        String?
  // LEGADO: vínculo direto 1:N com processo. Mantido por compatibilidade, prefira a tabela pivot ProcessoDocumento
  processoId         String?
  clienteId          String?
  contratoId         String?
  movimentacaoId     String?
  uploadedById       String?
  metadados          Json?
  origem             DocumentoOrigem @default(ESCRITORIO)
  visivelParaCliente Boolean         @default(false)
  visivelParaEquipe  Boolean         @default(true)
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt

  tenant              Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  processo            Processo?             @relation("DocumentoProcesso", fields: [processoId], references: [id], onDelete: SetNull)
  cliente             Cliente?              @relation("DocumentoCliente", fields: [clienteId], references: [id], onDelete: SetNull)
  contrato            Contrato?             @relation("ContratoDocumentos", fields: [contratoId], references: [id], onDelete: SetNull)
  movimentacao        MovimentacaoProcesso? @relation("MovimentacaoDocumentos", fields: [movimentacaoId], references: [id], onDelete: SetNull)
  uploadedBy          Usuario?              @relation("DocumentoUploader", fields: [uploadedById], references: [id], onDelete: SetNull)
  processosVinculados ProcessoDocumento[]
  assinaturas         DocumentoAssinatura[]

  @@index([processoId])
  @@index([clienteId])
  @@index([tenantId, createdAt])
}

model ProcessoDocumento {
  id                 String   @id @default(cuid())
  tenantId           String
  tenant             Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  processoId         String
  documentoId        String
  tag                String?
  nota               String?
  createdById        String?
  visivelParaCliente Boolean?
  createdAt          DateTime @default(now())

  processo  Processo  @relation(fields: [processoId], references: [id], onDelete: Cascade)
  documento Documento @relation(fields: [documentoId], references: [id], onDelete: Cascade)
  createdBy Usuario?  @relation("ProcessoDocumentoCriador", fields: [createdById], references: [id], onDelete: SetNull)

  @@unique([processoId, documentoId])
  @@index([tenantId, processoId])
}

model Contrato {
  id                    String         @id @default(cuid())
  tenantId              String
  clienteId             String
  modeloId              String?
  advogadoResponsavelId String?
  responsavelUsuarioId  String?
  criadoPorId           String?
  processoId            String?
  titulo                String
  tipoId                String?
  status                ContratoStatus @default(RASCUNHO)
  valor                 Decimal?       @db.Decimal(14, 2)
  moeda                 String?        @default("BRL")
  // Campos financeiros para comissões
  comissaoAdvogado      Decimal?       @db.Decimal(5, 2) @default(0.00) // Percentual específico para este contrato (0-100)
  percentualAcaoGanha   Decimal?       @db.Decimal(5, 2) @default(0.00) // Percentual sobre resultado em ação ganha (0-100)
  valorAcaoGanha        Decimal?       @db.Decimal(14, 2) @default(0.00) // Valor base para cálculo de comissão em ação ganha
  dataInicio            DateTime?
  dataFim               DateTime?
  dataAssinatura        DateTime?
  resumo                String?
  arquivoUrl            String?
  observacoes           String?
  createdAt             DateTime       @default(now())
  updatedAt             DateTime       @updatedAt

  tenant              Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  cliente             Cliente         @relation(fields: [clienteId], references: [id], onDelete: Cascade)
  modelo              ModeloContrato? @relation(fields: [modeloId], references: [id], onDelete: SetNull)
  advogadoResponsavel Advogado?       @relation("ContratoAdvogado", fields: [advogadoResponsavelId], references: [id], onDelete: SetNull)
  tipo                TipoContrato?   @relation(fields: [tipoId], references: [id], onDelete: SetNull)
  responsavelUsuario  Usuario?        @relation("ContratoResponsavel", fields: [responsavelUsuarioId], references: [id], onDelete: SetNull)
  criadoPor           Usuario?        @relation("ContratoCriador", fields: [criadoPorId], references: [id], onDelete: SetNull)
  processo            Processo?       @relation(fields: [processoId], references: [id], onDelete: SetNull)
  documentos          Documento[]     @relation("ContratoDocumentos")
  faturas             Fatura[]

  @@index([clienteId])
  @@index([status])
  @@index([tipoId])
}

model ModeloContrato {
  id        String   @id @default(cuid())
  tenantId  String
  tipoId    String?
  nome      String
  descricao String?
  categoria String?
  idioma    String?  @default("pt-BR")
  conteudo  String
  variaveis Json?
  publico   Boolean  @default(false)
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tenant    Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tipo      TipoContrato? @relation(fields: [tipoId], references: [id], onDelete: SetNull)
  contratos Contrato[]

  @@index([tipoId])
}

model Tarefa {
  id            String           @id @default(cuid())
  tenantId      String
  titulo        String
  descricao     String?
  status        TarefaStatus     @default(PENDENTE)
  prioridade    TarefaPrioridade @default(MEDIA)
  processoId    String?
  clienteId     String?
  categoriaId   String?
  responsavelId String?
  criadoPorId   String?
  dataLimite    DateTime?
  completedAt   DateTime?
  lembreteEm    DateTime?
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt

  tenant      Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  processo    Processo?        @relation(fields: [processoId], references: [id], onDelete: SetNull)
  cliente     Cliente?         @relation("TarefaCliente", fields: [clienteId], references: [id], onDelete: SetNull)
  categoria   CategoriaTarefa? @relation(fields: [categoriaId], references: [id], onDelete: SetNull)
  responsavel Usuario?         @relation("TarefasResponsaveis", fields: [responsavelId], references: [id], onDelete: SetNull)
  criadoPor   Usuario?         @relation("TarefasCriadas", fields: [criadoPorId], references: [id], onDelete: SetNull)

  @@index([processoId])
  @@index([responsavelId])
  @@index([status])
  @@index([categoriaId])
}

model Plano {
  id              String   @id @default(cuid())
  nome            String
  slug            String   @unique
  descricao       String?
  valorMensal     Decimal? @db.Decimal(10, 2)
  valorAnual      Decimal? @db.Decimal(10, 2)
  moeda           String   @default("BRL")
  limiteUsuarios  Int?
  limiteProcessos Int?
  limiteStorageMb Int?
  recursos        Json?
  ativo           Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  subscriptions TenantSubscription[]
}

model TenantSubscription {
  id                     String             @id @default(cuid())
  tenantId               String             @unique
  planoId                String?
  status                 SubscriptionStatus @default(TRIAL)
  dataInicio             DateTime           @default(now())
  dataFim                DateTime?
  renovaEm               DateTime?
  trialEndsAt            DateTime?
  externalCustomerId     String?
  externalSubscriptionId String?
  metadata               Json?
  createdAt              DateTime           @default(now())
  updatedAt              DateTime           @updatedAt

  tenant  Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  plano   Plano?   @relation(fields: [planoId], references: [id], onDelete: SetNull)
  faturas Fatura[]
}

model Fatura {
  id                String        @id @default(cuid())
  tenantId          String
  subscriptionId    String?
  contratoId        String?
  numero            String?
  descricao         String?
  valor             Decimal       @db.Decimal(12, 2)
  moeda             String        @default("BRL")
  status            InvoiceStatus @default(RASCUNHO)
  // Campos financeiros para comissões
  comissaoAdvogado  Decimal?      @db.Decimal(5, 2) @default(0.00) // Percentual de comissão aplicado nesta fatura (0-100)
  valorComissao     Decimal?      @db.Decimal(14, 2) @default(0.00) // Valor calculado da comissão do advogado
  tipoComissao      TipoComissao? @default(HONORARIOS) // Tipo de comissão
  periodoInicio     DateTime?
  periodoFim        DateTime?
  vencimento        DateTime?
  pagoEm            DateTime?
  externalInvoiceId String?
  urlBoleto         String?
  metadata          Json?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  tenant       Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  subscription TenantSubscription? @relation(fields: [subscriptionId], references: [id], onDelete: SetNull)
  contrato     Contrato?           @relation(fields: [contratoId], references: [id], onDelete: SetNull)
  pagamentos   Pagamento[]

  @@index([tenantId, status])
}

model Pagamento {
  id           String        @id @default(cuid())
  tenantId     String
  faturaId     String
  valor        Decimal       @db.Decimal(12, 2)
  status       PaymentStatus @default(PENDENTE)
  // Campos financeiros para comissões
  comissaoAdvogado Decimal?  @db.Decimal(5, 2) @default(0.00) // Percentual de comissão aplicado neste pagamento (0-100)
  valorComissao    Decimal?  @db.Decimal(14, 2) @default(0.00) // Valor da comissão paga ao advogado
  pagoParaAdvogado Boolean   @default(false) // Indica se a comissão já foi paga ao advogado
  metodo       String?
  transacaoId  String?
  autorizadoEm DateTime?
  confirmadoEm DateTime?
  estornadoEm  DateTime?
  detalhes     Json?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  fatura Fatura @relation(fields: [faturaId], references: [id], onDelete: Cascade)

  @@index([faturaId])
}

model AuditLog {
  id         String   @id @default(cuid())
  tenantId   String
  usuarioId  String?
  acao       String
  entidade   String
  entidadeId String?
  dados      Json?
  ip         String?
  userAgent  String?
  createdAt  DateTime @default(now())

  tenant  Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  usuario Usuario? @relation(fields: [usuarioId], references: [id], onDelete: SetNull)

  @@index([tenantId, entidade])
}

model Evento {
  id                    String           @id @default(cuid())
  tenantId              String
  titulo                String
  descricao             String?
  tipo                  EventoTipo       @default(REUNIAO)
  status                EventoStatus     @default(AGENDADO)
  dataInicio            DateTime
  dataFim               DateTime
  local                 String?
  participantes         String[]         // Array de emails dos participantes
  processoId            String?
  clienteId             String?
  advogadoResponsavelId String?
  criadoPorId           String?
  recorrencia           EventoRecorrencia @default(NENHUMA)
  recorrenciaFim        DateTime?
  googleEventId         String?          // ID do evento no Google Calendar
  googleCalendarId      String?          // ID do calendário do Google
  lembreteMinutos       Int?             // Lembrete em minutos antes do evento
  observacoes           String?
  createdAt             DateTime         @default(now())
  updatedAt             DateTime         @updatedAt

  tenant                Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  processo              Processo?        @relation(fields: [processoId], references: [id], onDelete: SetNull)
  cliente               Cliente?         @relation(fields: [clienteId], references: [id], onDelete: SetNull)
  advogadoResponsavel   Advogado?        @relation(fields: [advogadoResponsavelId], references: [id], onDelete: SetNull)
  criadoPor             Usuario?         @relation(fields: [criadoPorId], references: [id], onDelete: SetNull)

  @@index([tenantId, dataInicio])
  @@index([tenantId, status])
  @@index([processoId])
  @@index([clienteId])
  @@index([advogadoResponsavelId])
  @@index([googleEventId])
}

model DocumentoAssinatura {
  id                    String                    @id @default(cuid())
  tenantId              String
  documentoId           String
  processoId            String?
  clienteId             String
  advogadoResponsavelId String?
  titulo                String
  descricao             String?
  status                DocumentoAssinaturaStatus @default(PENDENTE)
  urlDocumento          String                    // URL do documento para assinatura
  urlAssinado           String?                   // URL do documento após assinatura
  clicksignDocumentId   String?                   // ID do documento no ClickSign
  clicksignSignerId     String?                   // ID do signatário no ClickSign
  dataEnvio             DateTime?
  dataAssinatura        DateTime?
  dataExpiracao         DateTime?
  observacoes           String?
  criadoPorId           String?
  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt

  tenant                Tenant                    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  documento             Documento                 @relation(fields: [documentoId], references: [id], onDelete: Cascade)
  processo              Processo?                 @relation(fields: [processoId], references: [id], onDelete: SetNull)
  cliente               Cliente                   @relation(fields: [clienteId], references: [id], onDelete: Cascade)
  advogadoResponsavel   Advogado?                 @relation(fields: [advogadoResponsavelId], references: [id], onDelete: SetNull)
  criadoPor             Usuario?                  @relation(fields: [criadoPorId], references: [id], onDelete: SetNull)

  @@index([tenantId, status])
  @@index([tenantId, clienteId])
  @@index([processoId])
  @@index([clicksignDocumentId])
}


model Julgamento {
  id                String        @id @default(cuid())
  tenantId          String
  juizId            String
  processoId        String?
  titulo            String
  descricao         String?
  dataJulgamento    DateTime
  tipoJulgamento    String        // "SENTENCA", "DECISAO", "ACORDAO", "DESPACHO", etc.
  resultado         String?       // "PROCEDENTE", "IMPROCEDENTE", "PARCIALMENTE_PROCEDENTE", etc.
  valorCausa        Decimal?      @db.Decimal(14, 2)
  valorCondenacao   Decimal?      @db.Decimal(14, 2)
  observacoes       String?
  pontosPositivos   String[]      // Pontos que o juiz gostou
  pontosNegativos   String[]      // Pontos que o juiz não gostou
  estrategias       String[]      // Estratégias que funcionaram
  recomendacoes     String[]      // Recomendações para futuros processos
  tags              String[]      // Tags para categorização
  isPublico         Boolean       @default(false)
  criadoPorId       String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  // Relacionamentos
  tenant            Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  juiz              Juiz          @relation(fields: [juizId], references: [id], onDelete: Cascade)
  processo          Processo?     @relation(fields: [processoId], references: [id], onDelete: SetNull)
  criadoPor         Usuario?      @relation("JulgamentoCriador", fields: [criadoPorId], references: [id], onDelete: SetNull)

  @@map("Julgamentos")
}

model AnaliseJuiz {
  id                String        @id @default(cuid())
  tenantId          String
  juizId            String
  titulo            String
  descricao         String?
  tipoAnalise       String        // "PERFIL", "TENDENCIA", "ESTATISTICA", "COMPARATIVO", etc.
  dados             Json          // Dados da análise em formato JSON
  conclusoes        String[]
  recomendacoes     String[]
  isPublico         Boolean       @default(false)
  criadoPorId       String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  // Relacionamentos
  tenant            Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  juiz              Juiz          @relation(fields: [juizId], references: [id], onDelete: Cascade)
  criadoPor         Usuario?      @relation("AnaliseJuizCriador", fields: [criadoPorId], references: [id], onDelete: SetNull)

  @@map("AnalisesJuiz")
}

model FavoritoJuiz {
  id                String        @id @default(cuid())
  tenantId          String
  juizId            String
  usuarioId         String
  observacoes       String?
  tags              String[]
  createdAt         DateTime      @default(now())

  // Relacionamentos
  tenant            Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  juiz              Juiz          @relation(fields: [juizId], references: [id], onDelete: Cascade)
  usuario           Usuario       @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([tenantId, juizId, usuarioId])
  @@map("FavoritosJuiz")
}

model AcessoJuiz {
  id                String        @id @default(cuid())
  tenantId          String
  juizId            String
  usuarioId         String
  tipoAcesso        String        // "CONSULTA", "DOWNLOAD", "ANALISE", etc.
  dataAcesso        DateTime      @default(now())
  ipAddress         String?
  userAgent         String?
  observacoes       String?

  // Relacionamentos
  tenant            Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  juiz              Juiz          @relation(fields: [juizId], references: [id], onDelete: Cascade)
  usuario           Usuario       @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@map("AcessosJuiz")
}
