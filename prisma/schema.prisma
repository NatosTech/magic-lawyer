generator client {
  provider = "prisma-client-js"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["magiclawyer", "support", "audit"]
}

model AreaProcesso {
  id        String     @id @default(cuid())
  tenantId  String?
  slug      String
  nome      String
  descricao String?
  ordem     Int?
  ativo     Boolean    @default(true)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  tenant    Tenant?    @relation(fields: [tenantId], references: [id])
  processos Processo[]

  @@unique([tenantId, slug])
  @@index([tenantId])
  @@index([nome])
  @@schema("magiclawyer")
}

model TipoContrato {
  id        String           @id @default(cuid())
  tenantId  String?
  slug      String
  nome      String
  descricao String?
  ordem     Int?
  ativo     Boolean          @default(true)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  contratos Contrato[]
  modelos   ModeloContrato[]
  tenant    Tenant?          @relation(fields: [tenantId], references: [id])

  @@unique([tenantId, slug])
  @@index([tenantId])
  @@index([nome])
  @@schema("magiclawyer")
}

model CategoriaTarefa {
  id        String   @id @default(cuid())
  tenantId  String?
  slug      String
  nome      String
  descricao String?
  corHex    String?
  ordem     Int?
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  tenant    Tenant?  @relation(fields: [tenantId], references: [id])
  tarefas   Tarefa[]

  @@unique([tenantId, slug])
  @@index([tenantId])
  @@index([nome])
  @@schema("magiclawyer")
}

model Tenant {
  id                    String                 @id @default(cuid())
  name                  String
  slug                  String                 @unique
  domain                String?                @unique
  timezone              String                 @default("America/Sao_Paulo")
  status                TenantStatus           @default(ACTIVE)
  tipoPessoa            TipoPessoa             @default(JURIDICA)
  documento             String?                @unique
  razaoSocial           String?
  nomeFantasia          String?
  inscricaoEstadual     String?
  inscricaoMunicipal    String?
  email                 String?
  telefone              String?
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  superAdminId          String?
  acessosJuiz           AcessoJuiz[]
  advogados             Advogado[]
  advogadoClientes      AdvogadoCliente[]
  analisesJuiz          AnaliseJuiz[]
  areasProcesso         AreaProcesso[]
  assinaturasPacoteJuiz AssinaturaPacoteJuiz[] @relation("TenantAssinaturaPacote")
  auditLogs             AuditLog[]
  categoriasTarefa      CategoriaTarefa[]
  clientes              Cliente[]
  contratos             Contrato[]
  contratoDocumentos    ContratoDocumento[]
  documentos            Documento[]
  documentoAssinaturas  DocumentoAssinatura[]
  eventos               Evento[]
  eventoParticipantes   EventoParticipante[]
  faturas               Fatura[]
  favoritosJuiz         FavoritoJuiz[]
  julgamentos           Julgamento[]
  modelosContrato       ModeloContrato[]
  modelosPeticao        ModeloPeticao[]
  tiposPeticao          TipoPeticao[]
  modelosProcuracao     ModeloProcuracao[]
  movimentacoes         MovimentacaoProcesso[]
  autosProcessuais      AutoProcessual[]
  causas                Causa[]
  diligencias           Diligencia[]
  regimesPrazo          RegimePrazo[]
  peticoes              Peticao[]
  assinaturasPeticao    AssinaturaPeticao[]
  notificacoes          Notificacao[]
  notificacoesUsuarios  NotificacaoUsuario[]
  pagamentos            Pagamento[]
  pagamentoComissoes    PagamentoComissao[]
  processos             Processo[]
  processoDocumentos    ProcessoDocumento[]
  processoPartes        ProcessoParte[]
  processoPrazos        ProcessoPrazo[]
  procuracoes           Procuracao[]
  procuracaoAdvogados   ProcuracaoAdvogado[]
  procuracaoAssinaturas ProcuracaoAssinatura[]
  procuracaoPoderes     ProcuracaoPoder[]
  procuracaoProcessos   ProcuracaoProcesso[]
  documentosProcuracao  DocumentoProcuracao[]
  tarefas               Tarefa[]
  superAdmin            SuperAdmin?            @relation("SuperAdminTenant", fields: [superAdminId], references: [id])
  branding              TenantBranding?
  enderecos             Endereco[]
  enderecosLegacy       TenantEndereco[]       @relation("TenantEnderecoLegacy")
  subscription          TenantSubscription?
  tiposContrato         TipoContrato[]
  tribunais             Tribunal[]
  usuarios              Usuario[]
  usuarioPermissoes     UsuarioPermissao[]
  documentoVersoes      DocumentoVersao[]
  contratoHonorarios    ContratoHonorario[]
  contratoParcelas      ContratoParcela[]
  tickets               Ticket[]               @relation("TenantTickets")
  ProcessoCausa         ProcessoCausa[]
  boards                Board[]
  boardColumns          BoardColumn[]
  tarefaChecklists      TarefaChecklist[]
  tarefaComentarios     TarefaComentario[]
  tarefaAnexos          TarefaAnexo[]
  tarefaTags            TarefaTag[]
  tarefaAtividades      TarefaAtividade[]
  tarefaTagRelacoes     TarefaTagRelacao[]
  TarefaWatcher         TarefaWatcher[]
  feriados              Feriado[]
  dadosBancarios        DadosBancarios[]
  planos                Plano[]
  asaasConfig           TenantAsaasConfig?
  advogadoHistorico     AdvogadoHistorico[]

  // Sistema de Gestão de Equipe
  cargos                       Cargo[]
  cargoPermissoes              CargoPermissao[]
  usuarioCargos                UsuarioCargo[]
  usuarioPermissoesIndividuais UsuarioPermissaoIndividual[]
  usuarioVinculacoes           UsuarioVinculacao[]
  equipeHistorico              EquipeHistorico[]
  equipeConvites               EquipeConvite[]

  @@index([status])
  @@index([superAdminId])
  @@schema("magiclawyer")
}

model Endereco {
  id          String       @id @default(cuid())
  tenantId    String
  apelido     String
  tipo        TipoEndereco @default(ESCRITORIO)
  principal   Boolean      @default(false)
  logradouro  String
  numero      String?
  complemento String?
  bairro      String?
  cidade      String
  estado      String
  cep         String?
  pais        String       @default("Brasil")
  telefone    String?
  observacoes String?

  // Relacionamentos opcionais - apenas um será preenchido
  usuarioId String?
  clienteId String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tenant  Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  usuario Usuario? @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  cliente Cliente? @relation(fields: [clienteId], references: [id], onDelete: Cascade)

  @@unique([tenantId, apelido])
  @@index([tenantId, principal])
  @@index([usuarioId])
  @@index([clienteId])
  @@schema("magiclawyer")
}

// ============================================
// SISTEMA DE PAGAMENTOS ASAAS
// ============================================

model TenantAsaasConfig {
  id               String        @id @default(cuid())
  tenantId         String        @unique
  asaasApiKey      String        @db.Text // Criptografado
  asaasAccountId   String
  asaasWalletId    String?
  ambiente         AsaasAmbiente @default(SANDBOX)
  integracaoAtiva  Boolean       @default(false)
  dataConfiguracao DateTime      @default(now())
  ultimaValidacao  DateTime?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([ambiente])
  @@schema("magiclawyer")
}

// Manter TenantEndereco para compatibilidade (deprecated)
model TenantEndereco {
  id          String       @id @default(cuid())
  tenantId    String
  apelido     String
  tipo        TipoEndereco @default(ESCRITORIO)
  principal   Boolean      @default(false)
  logradouro  String
  numero      String?
  complemento String?
  bairro      String?
  cidade      String
  estado      String
  cep         String?
  pais        String       @default("Brasil")
  telefone    String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  tenant      Tenant       @relation("TenantEnderecoLegacy", fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, apelido])
  @@index([tenantId, principal])
  @@schema("magiclawyer")
}

model TenantBranding {
  id                 String   @id @default(cuid())
  tenantId           String   @unique
  primaryColor       String?
  secondaryColor     String?
  accentColor        String?
  logoUrl            String?
  faviconUrl         String?
  loginBackgroundUrl String?
  emailFromName      String?
  emailFromAddress   String?
  customDomainText   String?
  settings           Json?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  tenant             Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@schema("magiclawyer")
}

model Usuario {
  id                           String                 @id @default(cuid())
  tenantId                     String
  email                        String
  passwordHash                 String?
  role                         UserRole               @default(SECRETARIA)
  firstName                    String?
  lastName                     String?
  phone                        String?
  avatarUrl                    String?
  active                       Boolean                @default(true)
  cpf                          String?
  rg                           String?
  dataNascimento               DateTime?
  observacoes                  String?
  lastLoginAt                  DateTime?
  createdById                  String?
  // Integração Google Calendar
  googleCalendarConnected      Boolean                @default(false)
  googleCalendarTokens         Json? // { access_token, refresh_token, expiry_date }
  googleCalendarId             String? // ID do calendário principal do usuário
  googleCalendarSyncEnabled    Boolean                @default(false)
  createdAt                    DateTime               @default(now())
  updatedAt                    DateTime               @updatedAt
  createdBy                    Usuario?               @relation("UsuarioCriador", fields: [createdById], references: [id])
  usuariosCriados              Usuario[]              @relation("UsuarioCriador")
  acessosJuiz                  AcessoJuiz[]
  advogado                     Advogado?
  analisesJuizCriadas          AnaliseJuiz[]          @relation("AnaliseJuizCriador")
  auditLogs                    AuditLog[]
  clientes                     Cliente[]              @relation("UsuarioCliente")
  contratosCriados             Contrato[]             @relation("ContratoCriador")
  contratosResponsavel         Contrato[]             @relation("ContratoResponsavel")
  documentos                   Documento[]            @relation("DocumentoUploader")
  documentoVersoesEnviadas     DocumentoVersao[]      @relation("DocumentoVersaoUploader")
  documentoVersoesAssinadas    DocumentoVersao[]      @relation("DocumentoVersaoAssinador")
  documentoAssinaturasCriadas  DocumentoAssinatura[]
  eventosCriados               Evento[]
  favoritosJuiz                FavoritoJuiz[]
  julgamentosCriados           Julgamento[]           @relation("JulgamentoCriador")
  movimentacoesCriadas         MovimentacaoProcesso[] @relation("MovimentacaoCriador")
  notificacoesCriadas          Notificacao[]          @relation("NotificacaoCriador")
  notificacoesRecebidas        NotificacaoUsuario[]
  processoDocumentosCriados    ProcessoDocumento[]    @relation("ProcessoDocumentoCriador")
  processoPrazosResponsavel    ProcessoPrazo[]        @relation("ProcessoPrazoResponsavel")
  procuracoesCriadas           Procuracao[]           @relation("ProcuracaoCriador")
  procuracaoAssinaturas        ProcuracaoAssinatura[]
  tarefasCriadas               Tarefa[]               @relation("TarefasCriadas")
  tarefas                      Tarefa[]               @relation("TarefasResponsaveis")
  autosProcessuaisCriados      AutoProcessual[]       @relation("AutoProcessualCriador")
  peticoesCriadas              Peticao[]              @relation("PeticaoCriador")
  assinaturasPeticao           AssinaturaPeticao[]
  diligenciasResponsavel       Diligencia[]           @relation("DiligenciaResponsavel")
  diligenciasCriadas           Diligencia[]           @relation("DiligenciaCriador")
  tenant                       Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  enderecos                    Endereco[]
  permissoes                   UsuarioPermissao[]
  ticketAttachments            TicketAttachment[]     @relation("UserAttachments")
  ticketMessages               TicketMessage[]        @relation("UserMessages")
  tickets                      Ticket[]               @relation("UserTickets")
  contratoParcelasResponsavel  ContratoParcela[]
  documentosProcuracaoUploaded DocumentoProcuracao[]  @relation("DocumentoProcuracaoUploader")
  tarefaComentarios            TarefaComentario[]
  tarefaAtividades             TarefaAtividade[]
  tarefasObservadas            TarefaWatcher[]
  dadosBancarios               DadosBancarios[]
  advogadoHistorico            AdvogadoHistorico[]
  planoVersoesCriadas          PlanoVersao[]          @relation("PlanoVersaoCriador")
  planoVersoesPublicadas       PlanoVersao[]          @relation("PlanoVersaoPublicador")

  // Sistema de Gestão de Equipe
  cargos                  UsuarioCargo[]
  permissoesIndividuais   UsuarioPermissaoIndividual[]
  vinculacoesComoServidor UsuarioVinculacao[]          @relation("UsuarioServidor")
  equipeHistorico         EquipeHistorico[]
  equipeConvites          EquipeConvite[]

  @@unique([email, tenantId])
  @@unique([tenantId, cpf])
  @@index([role])
  @@schema("magiclawyer")
}

model SuperAdmin {
  id                String               @id @default(cuid())
  email             String               @unique
  firstName         String
  lastName          String
  passwordHash      String?
  image             String?
  emailVerified     DateTime?
  status            String               @default("ACTIVE")
  lastLoginAt       DateTime?
  lastLoginIp       String?
  preferences       Json?
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt
  configuracoes     ConfiguracaoPreco[]  @relation("SuperAdminConfiguracao")
  juizesCriados     Juiz[]               @relation("SuperAdminJuiz")
  pacotesJuiz       PacoteJuiz[]         @relation("SuperAdminPacoteJuiz")
  logsAuditoria     SuperAdminAuditLog[]
  tenantGerenciados Tenant[]             @relation("SuperAdminTenant")

  @@schema("magiclawyer")
}

model SuperAdminAuditLog {
  id           String     @id @default(cuid())
  superAdminId String
  acao         String
  entidade     String
  entidadeId   String?
  dadosAntigos Json?
  dadosNovos   Json?
  ipAddress    String?
  userAgent    String?
  createdAt    DateTime   @default(now())
  superAdmin   SuperAdmin @relation(fields: [superAdminId], references: [id], onDelete: Cascade)

  @@index([superAdminId])
  @@index([acao])
  @@index([entidade])
  @@index([createdAt])
  @@schema("magiclawyer")
}

model Advogado {
  id                 String                  @id @default(cuid())
  tenantId           String
  usuarioId          String                  @unique
  oabNumero          String?
  oabUf              String?
  especialidades     EspecialidadeJuridica[]
  bio                String?
  telefone           String?
  whatsapp           String?
  comissaoPadrao     Decimal                 @default(0.00) @db.Decimal(5, 2)
  comissaoAcaoGanha  Decimal                 @default(0.00) @db.Decimal(5, 2)
  comissaoHonorarios Decimal                 @default(0.00) @db.Decimal(5, 2)
  isExterno          Boolean                 @default(false) // Identifica se o advogado não é do escritório

  // Dados profissionais adicionais
  formacao    String? // Formação acadêmica
  experiencia String? // Experiência profissional
  premios     String? // Prêmios e reconhecimentos
  publicacoes String? // Publicações e artigos
  website     String? // Website pessoal
  linkedin    String? // LinkedIn
  twitter     String? // Twitter/X
  instagram   String? // Instagram

  // Configurações de notificação
  notificarEmail    Boolean @default(true)
  notificarWhatsapp Boolean @default(true)
  notificarSistema  Boolean @default(true)

  // Configurações de acesso
  podeCriarProcessos    Boolean @default(true)
  podeEditarProcessos   Boolean @default(true)
  podeExcluirProcessos  Boolean @default(false)
  podeGerenciarClientes Boolean @default(true)
  podeAcessarFinanceiro Boolean @default(false)

  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  tenant               Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  usuario              Usuario               @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  clientes             AdvogadoCliente[]
  contratos            Contrato[]            @relation("ContratoAdvogado")
  honorarios           ContratoHonorario[]
  historico            AdvogadoHistorico[]
  documentoAssinaturas DocumentoAssinatura[]
  eventos              Evento[]
  pagamentoComissoes   PagamentoComissao[]
  processos            Processo[]            @relation("ProcessoAdvogadoResponsavel")
  procuracoes          ProcuracaoAdvogado[]
  ProcessoParte        ProcessoParte[]

  // Sistema de Gestão de Equipe
  vinculacoesServidas UsuarioVinculacao[] @relation("UsuarioAdvogado")

  @@unique([tenantId, oabUf, oabNumero])
  @@schema("magiclawyer")
}

model Cliente {
  id                   String                @id @default(cuid())
  tenantId             String
  tipoPessoa           TipoPessoa
  nome                 String
  documento            String?
  email                String?
  telefone             String?
  celular              String?
  dataNascimento       DateTime?
  inscricaoEstadual    String?
  responsavelNome      String?
  responsavelEmail     String?
  responsavelTelefone  String?
  observacoes          String?
  asaasCustomerId      String? // ID do cliente no Asaas
  usuarioId            String?
  deletedAt            DateTime?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  advogadoClientes     AdvogadoCliente[]
  tenant               Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  usuario              Usuario?              @relation("UsuarioCliente", fields: [usuarioId], references: [id])
  enderecos            Endereco[]
  contratos            Contrato[]
  documentos           Documento[]           @relation("DocumentoCliente")
  documentoAssinaturas DocumentoAssinatura[]
  eventos              Evento[]
  processos            Processo[]
  procuracoes          Procuracao[]
  tarefas              Tarefa[]              @relation("TarefaCliente")
  ProcessoParte        ProcessoParte[]
  dadosBancarios       DadosBancarios[]

  @@unique([tenantId, documento])
  @@unique([tenantId, usuarioId])
  @@index([nome])
  @@index([documento])
  @@index([asaasCustomerId])
  @@index([tenantId, deletedAt])
  @@schema("magiclawyer")
}

model AdvogadoHistorico {
  id            String   @id @default(cuid())
  tenantId      String
  advogadoId    String
  usuarioId     String // Usuário que fez a alteração
  acao          String // CREATE, UPDATE, DELETE, CONVERT_EXTERNAL_TO_INTERNAL, etc.
  campo         String? // Nome do campo alterado (opcional)
  valorAnterior String? // Valor anterior (opcional)
  valorNovo     String? // Valor novo (opcional)
  detalhes      String? // Detalhes adicionais da alteração
  ipAddress     String? // IP do usuário
  userAgent     String? // User agent do navegador
  createdAt     DateTime @default(now())

  tenant   Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  advogado Advogado @relation(fields: [advogadoId], references: [id], onDelete: Cascade)
  usuario  Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([advogadoId])
  @@index([usuarioId])
  @@index([createdAt])
  @@schema("magiclawyer")
}

model AdvogadoCliente {
  id             String   @id @default(cuid())
  tenantId       String
  advogadoId     String
  clienteId      String
  relacionamento String?
  createdAt      DateTime @default(now())
  advogado       Advogado @relation(fields: [advogadoId], references: [id], onDelete: Cascade)
  cliente        Cliente  @relation(fields: [clienteId], references: [id], onDelete: Cascade)
  tenant         Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([advogadoId, clienteId])
  @@index([clienteId])
  @@schema("magiclawyer")
}

model Juiz {
  id                String                  @id @default(cuid())
  tribunalId        String?
  nome              String
  nomeCompleto      String?
  cpf               String?                 @unique
  oab               String?
  email             String?
  telefone          String?
  endereco          String?
  cidade            String?
  estado            String?
  cep               String?
  dataNascimento    DateTime?
  dataPosse         DateTime?
  dataAposentadoria DateTime?
  status            JuizStatus              @default(ATIVO)
  nivel             JuizNivel               @default(JUIZ_TITULAR)
  especialidades    EspecialidadeJuridica[]
  vara              String?
  comarca           String?
  biografia         String?
  formacao          String?
  experiencia       String?
  premios           String?
  publicacoes       String?
  foto              String?
  website           String?
  linkedin          String?
  twitter           String?
  instagram         String?
  observacoes       String?
  isPublico         Boolean                 @default(true)
  isPremium         Boolean                 @default(false)
  precoAcesso       Decimal?                @db.Decimal(10, 2)
  superAdminId      String?
  createdAt         DateTime                @default(now())
  updatedAt         DateTime                @updatedAt
  acessos           AcessoJuiz[]
  analises          AnaliseJuiz[]
  favoritos         FavoritoJuiz[]
  superAdmin        SuperAdmin?             @relation("SuperAdminJuiz", fields: [superAdminId], references: [id])
  tribunal          Tribunal?               @relation(fields: [tribunalId], references: [id])
  julgamentos       Julgamento[]
  pacotes           PacoteJuizItem[]        @relation("JuizPacote")
  processos         Processo[]

  @@index([nome])
  @@index([superAdminId])
  @@index([status])
  @@index([especialidades])
  @@schema("magiclawyer")
}

model Tribunal {
  id        String     @id @default(cuid())
  tenantId  String?
  nome      String
  sigla     String?
  esfera    String?
  uf        String?
  siteUrl   String?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  juizes    Juiz[]
  processos Processo[]
  feriados  Feriado[]
  tenant    Tenant?    @relation(fields: [tenantId], references: [id])

  @@unique([nome, uf])
  @@schema("magiclawyer")
}

model Notificacao {
  id             String                @id @default(cuid())
  tenantId       String
  titulo         String
  mensagem       String
  tipo           NotificacaoTipo       @default(SISTEMA)
  prioridade     NotificacaoPrioridade @default(MEDIA)
  canais         NotificacaoCanal[]    @default([IN_APP])
  dados          Json?
  referenciaTipo String?
  referenciaId   String?
  agendarPara    DateTime?
  expiracaoEm    DateTime?
  createdAt      DateTime              @default(now())
  createdById    String?
  updatedAt      DateTime              @updatedAt
  createdBy      Usuario?              @relation("NotificacaoCriador", fields: [createdById], references: [id])
  tenant         Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  destinos       NotificacaoUsuario[]

  @@index([tenantId, tipo])
  @@index([tenantId, prioridade])
  @@index([tenantId, agendarPara])
  @@index([tenantId, createdAt])
  @@schema("magiclawyer")
}

model NotificacaoUsuario {
  id             String            @id @default(cuid())
  notificacaoId  String
  tenantId       String
  usuarioId      String
  canal          NotificacaoCanal  @default(IN_APP)
  status         NotificacaoStatus @default(NAO_LIDA)
  entregueEm     DateTime?
  lidoEm         DateTime?
  reabertoEm     DateTime?
  tentativaAtual Int               @default(0)
  ultimoErro     String?
  metadata       Json?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  notificacao    Notificacao       @relation(fields: [notificacaoId], references: [id], onDelete: Cascade)
  tenant         Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  usuario        Usuario           @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([notificacaoId, usuarioId, canal])
  @@index([tenantId, usuarioId, status])
  @@index([tenantId, createdAt])
  @@schema("magiclawyer")
}

model UsuarioPermissao {
  id        String           @id @default(cuid())
  tenantId  String
  usuarioId String
  permissao TenantPermission
  createdAt DateTime         @default(now())
  tenant    Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  usuario   Usuario          @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([tenantId, usuarioId, permissao])
  @@index([tenantId, permissao])
  @@schema("magiclawyer")
}

model Processo {
  id                    String                 @id @default(cuid())
  tenantId              String
  numero                String
  numeroCnj             String?
  grau                  ProcessoGrau?
  fase                  ProcessoFase?
  titulo                String?
  descricao             String?
  status                ProcessoStatus         @default(RASCUNHO)
  areaId                String?
  classeProcessual      String?
  orgaoJulgador         String?
  vara                  String?
  comarca               String?
  foro                  String?
  dataDistribuicao      DateTime?
  segredoJustica        Boolean                @default(false)
  valorCausa            Decimal?               @db.Decimal(14, 2)
  rito                  String?
  clienteId             String
  advogadoResponsavelId String?
  juizId                String?
  tribunalId            String?
  tags                  Json?
  prazoPrincipal        DateTime?
  numeroInterno         String?
  pastaCompartilhadaUrl String?
  deletedAt             DateTime?
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  contratos             Contrato[]
  documentos            Documento[]            @relation("DocumentoProcesso")
  documentoAssinaturas  DocumentoAssinatura[]
  eventos               Evento[]
  julgamentos           Julgamento[]
  movimentacoes         MovimentacaoProcesso[]
  advogadoResponsavel   Advogado?              @relation("ProcessoAdvogadoResponsavel", fields: [advogadoResponsavelId], references: [id])
  area                  AreaProcesso?          @relation(fields: [areaId], references: [id])
  cliente               Cliente                @relation(fields: [clienteId], references: [id], onDelete: Cascade)
  juiz                  Juiz?                  @relation(fields: [juizId], references: [id])
  tenant                Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tribunal              Tribunal?              @relation(fields: [tribunalId], references: [id])
  documentosVinculados  ProcessoDocumento[]
  procuracoesVinculadas ProcuracaoProcesso[]
  tarefas               Tarefa[]
  partes                ProcessoParte[]
  prazos                ProcessoPrazo[]
  autos                 AutoProcessual[]
  causasVinculadas      ProcessoCausa[]
  diligencias           Diligencia[]
  peticoes              Peticao[]
  contratoDocumentos    ContratoDocumento[]

  @@unique([tenantId, numero])
  @@index([tenantId, status])
  @@index([tenantId, clienteId])
  @@index([tenantId, createdAt])
  @@index([tenantId, deletedAt])
  @@schema("magiclawyer")
}

model ProcessoParte {
  id          String       @id @default(cuid())
  tenantId    String
  processoId  String
  tipoPolo    ProcessoPolo
  nome        String
  documento   String?
  email       String?
  telefone    String?
  clienteId   String?
  advogadoId  String?
  papel       String?
  observacoes String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  processo    Processo     @relation(fields: [processoId], references: [id], onDelete: Cascade)
  tenant      Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  cliente     Cliente?     @relation(fields: [clienteId], references: [id])
  advogado    Advogado?    @relation(fields: [advogadoId], references: [id])

  @@index([tenantId, processoId])
  @@index([tenantId, tipoPolo])
  @@index([clienteId])
  @@index([advogadoId])
  @@schema("magiclawyer")
}

model ProcessoPrazo {
  id                   String                @id @default(cuid())
  tenantId             String
  processoId           String
  titulo               String
  descricao            String?
  fundamentoLegal      String?
  status               ProcessoPrazoStatus   @default(ABERTO)
  dataVencimento       DateTime
  dataCumprimento      DateTime?
  prorrogadoPara       DateTime?
  responsavelId        String?
  origemMovimentacaoId String?
  regimePrazoId        String?
  causaId              String?
  diligenciaId         String?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  processo             Processo              @relation(fields: [processoId], references: [id], onDelete: Cascade)
  tenant               Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  responsavel          Usuario?              @relation("ProcessoPrazoResponsavel", fields: [responsavelId], references: [id])
  origemMovimentacao   MovimentacaoProcesso? @relation(fields: [origemMovimentacaoId], references: [id])
  regimePrazo          RegimePrazo?          @relation(fields: [regimePrazoId], references: [id])
  causa                Causa?                @relation(fields: [causaId], references: [id])
  diligencia           Diligencia?           @relation("DiligenciaPrazos", fields: [diligenciaId], references: [id], onDelete: SetNull)

  @@index([tenantId, processoId])
  @@index([tenantId, status])
  @@index([tenantId, dataVencimento])
  @@index([regimePrazoId])
  @@index([causaId])
  @@index([diligenciaId])
  @@schema("magiclawyer")
}

model Procuracao {
  id                    String                 @id @default(cuid())
  tenantId              String
  clienteId             String
  modeloId              String? // Referência ao modelo usado
  numero                String?
  arquivoUrl            String?
  observacoes           String?
  emitidaEm             DateTime?
  validaAte             DateTime?
  revogadaEm            DateTime?
  ativa                 Boolean                @default(true)
  status                ProcuracaoStatus       @default(RASCUNHO)
  assinadaPeloClienteEm DateTime?
  emitidaPor            ProcuracaoEmitidaPor   @default(ESCRITORIO)
  createdById           String?
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  cliente               Cliente                @relation(fields: [clienteId], references: [id], onDelete: Cascade)
  modelo                ModeloProcuracao?      @relation(fields: [modeloId], references: [id])
  createdBy             Usuario?               @relation("ProcuracaoCriador", fields: [createdById], references: [id])
  tenant                Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  outorgados            ProcuracaoAdvogado[]
  processos             ProcuracaoProcesso[]
  assinaturas           ProcuracaoAssinatura[]
  poderes               ProcuracaoPoder[]
  documentos            DocumentoProcuracao[]

  @@index([tenantId, clienteId])
  @@index([tenantId, ativa])
  @@index([tenantId, modeloId])
  @@schema("magiclawyer")
}

model ProcuracaoProcesso {
  id           String     @id @default(cuid())
  tenantId     String
  procuracaoId String
  processoId   String
  createdAt    DateTime   @default(now())
  processo     Processo   @relation(fields: [processoId], references: [id], onDelete: Cascade)
  procuracao   Procuracao @relation(fields: [procuracaoId], references: [id], onDelete: Cascade)
  tenant       Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([procuracaoId, processoId])
  @@index([tenantId, processoId])
  @@index([tenantId, procuracaoId])
  @@schema("magiclawyer")
}

model ProcuracaoAdvogado {
  id           String     @id @default(cuid())
  tenantId     String
  procuracaoId String
  advogadoId   String
  createdAt    DateTime   @default(now())
  advogado     Advogado   @relation(fields: [advogadoId], references: [id], onDelete: Cascade)
  procuracao   Procuracao @relation(fields: [procuracaoId], references: [id], onDelete: Cascade)
  tenant       Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([procuracaoId, advogadoId])
  @@index([tenantId, advogadoId])
  @@index([tenantId, procuracaoId])
  @@schema("magiclawyer")
}

model ProcuracaoAssinatura {
  id                 String         @id @default(cuid())
  tenantId           String
  procuracaoId       String
  usuarioId          String?
  assinanteNome      String
  assinanteDocumento String?
  assinanteEmail     String?
  assinanteTelefone  String?
  tipoAssinatura     AssinaturaTipo @default(MANUAL)
  ipAssinatura       String?
  provedorAssinatura String?
  hashArquivo        String?
  arquivoUrl         String?
  assinadaEm         DateTime?
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
  procuracao         Procuracao     @relation(fields: [procuracaoId], references: [id], onDelete: Cascade)
  tenant             Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  usuario            Usuario?       @relation(fields: [usuarioId], references: [id])

  @@index([tenantId, procuracaoId])
  @@index([tenantId, tipoAssinatura])
  @@schema("magiclawyer")
}

model ProcuracaoPoder {
  id           String     @id @default(cuid())
  tenantId     String
  procuracaoId String
  titulo       String?
  descricao    String
  ativo        Boolean    @default(true)
  revogadoEm   DateTime?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  procuracao   Procuracao @relation(fields: [procuracaoId], references: [id], onDelete: Cascade)
  tenant       Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, procuracaoId])
  @@index([tenantId, ativo])
  @@schema("magiclawyer")
}

model MovimentacaoProcesso {
  id                    String            @id @default(cuid())
  tenantId              String
  processoId            String
  titulo                String
  descricao             String?
  tipo                  MovimentacaoTipo?
  dataMovimentacao      DateTime          @default(now())
  prazo                 DateTime?
  criadoPorId           String?
  // Campos para notificações
  notificarCliente      Boolean           @default(false)
  notificarEmail        Boolean           @default(false)
  notificarWhatsapp     Boolean           @default(false)
  mensagemPersonalizada String?
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt
  documentos            Documento[]       @relation("MovimentacaoDocumentos")
  criadoPor             Usuario?          @relation("MovimentacaoCriador", fields: [criadoPorId], references: [id])
  processo              Processo          @relation(fields: [processoId], references: [id], onDelete: Cascade)
  tenant                Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  prazosRelacionados    ProcessoPrazo[]

  @@index([processoId])
  @@index([dataMovimentacao])
  @@index([tenantId, notificarCliente])
  @@schema("magiclawyer")
}

model Documento {
  id                  String                @id @default(cuid())
  tenantId            String
  nome                String
  tipo                String?
  descricao           String?
  url                 String
  tamanhoBytes        Int?
  contentType         String?
  processoId          String?
  clienteId           String?
  contratoId          String?
  movimentacaoId      String?
  uploadedById        String?
  autoId              String?
  metadados           Json?
  origem              DocumentoOrigem       @default(ESCRITORIO)
  visivelParaCliente  Boolean               @default(false)
  visivelParaEquipe   Boolean               @default(true)
  deletedAt           DateTime?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  cliente             Cliente?              @relation("DocumentoCliente", fields: [clienteId], references: [id])
  contrato            Contrato?             @relation("ContratoDocumentos", fields: [contratoId], references: [id])
  movimentacao        MovimentacaoProcesso? @relation("MovimentacaoDocumentos", fields: [movimentacaoId], references: [id])
  processo            Processo?             @relation("DocumentoProcesso", fields: [processoId], references: [id])
  tenant              Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  uploadedBy          Usuario?              @relation("DocumentoUploader", fields: [uploadedById], references: [id])
  autoProcessual      AutoProcessual?       @relation(fields: [autoId], references: [id])
  assinaturas         DocumentoAssinatura[]
  processosVinculados ProcessoDocumento[]
  versoes             DocumentoVersao[]
  comprovanteParcelas ContratoParcela[]     @relation("ContratoParcelaComprovante")
  contratosVinculados ContratoDocumento[]   @relation("ContratoDocumentoDocumento")
  Peticao             Peticao[]
  Diligencia          Diligencia[]

  @@index([tenantId, visivelParaCliente])
  @@index([tenantId, deletedAt])
  @@index([processoId])
  @@index([clienteId])
  @@index([autoId])
  @@index([tenantId, createdAt])
  @@schema("magiclawyer")
}

model ProcessoDocumento {
  id                 String    @id @default(cuid())
  tenantId           String
  processoId         String
  documentoId        String
  tag                String?
  nota               String?
  createdById        String?
  visivelParaCliente Boolean?
  createdAt          DateTime  @default(now())
  createdBy          Usuario?  @relation("ProcessoDocumentoCriador", fields: [createdById], references: [id])
  documento          Documento @relation(fields: [documentoId], references: [id], onDelete: Cascade)
  processo           Processo  @relation(fields: [processoId], references: [id], onDelete: Cascade)
  tenant             Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([processoId, documentoId])
  @@index([tenantId, processoId])
  @@index([tenantId, documentoId])
  @@schema("magiclawyer")
}

model RegimePrazo {
  id              String          @id @default(cuid())
  tenantId        String?
  nome            String
  tipo            RegimePrazoTipo
  descricao       String?
  contarDiasUteis Boolean         @default(true)
  observacoes     String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  tenant          Tenant?         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  prazos          ProcessoPrazo[]
  diligencias     Diligencia[]

  @@unique([tenantId, nome])
  @@schema("magiclawyer")
}

model Feriado {
  id         String      @id @default(cuid())
  tenantId   String?
  nome       String
  data       DateTime    @db.Date
  tipo       TipoFeriado @default(NACIONAL)
  tribunalId String?
  uf         String?
  municipio  String?
  descricao  String?
  recorrente Boolean     @default(true)
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  tenant     Tenant?     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tribunal   Tribunal?   @relation(fields: [tribunalId], references: [id])

  @@index([tenantId, data])
  @@index([tipo])
  @@index([uf])
  @@schema("magiclawyer")
}

model Causa {
  id                 String              @id @default(cuid())
  tenantId           String
  nome               String
  codigoCnj          String?
  descricao          String?
  ativo              Boolean             @default(true)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  tenant             Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  processos          ProcessoCausa[]
  diligencias        Diligencia[]
  prazos             ProcessoPrazo[]
  contratoDocumentos ContratoDocumento[]
  peticoes           Peticao[]

  @@unique([tenantId, nome])
  @@index([tenantId, ativo])
  @@schema("magiclawyer")
}

model ProcessoCausa {
  id         String   @id @default(cuid())
  tenantId   String
  processoId String
  causaId    String
  principal  Boolean  @default(false)
  createdAt  DateTime @default(now())
  processo   Processo @relation(fields: [processoId], references: [id], onDelete: Cascade)
  causa      Causa    @relation(fields: [causaId], references: [id], onDelete: Cascade)
  tenant     Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([processoId, causaId])
  @@index([tenantId, processoId])
  @@index([tenantId, causaId])
  @@schema("magiclawyer")
}

model AutoProcessual {
  id                   String      @id @default(cuid())
  tenantId             String
  processoId           String
  numeroVolume         Int?
  tipo                 String?
  descricao            String?
  dataDisponibilizacao DateTime?
  criadoPorId          String?
  createdAt            DateTime    @default(now())
  updatedAt            DateTime    @updatedAt
  processo             Processo    @relation(fields: [processoId], references: [id], onDelete: Cascade)
  tenant               Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  criadoPor            Usuario?    @relation("AutoProcessualCriador", fields: [criadoPorId], references: [id])
  documentos           Documento[]

  @@index([tenantId, processoId])
  @@schema("magiclawyer")
}

model Peticao {
  id              String              @id @default(cuid())
  tenantId        String
  processoId      String
  causaId         String?
  modeloId        String?
  titulo          String
  tipo            String?
  status          PeticaoStatus       @default(RASCUNHO)
  descricao       String?
  documentoId     String?
  protocoloNumero String?
  protocoladoEm   DateTime?
  criadoPorId     String?
  observacoes     String?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  processo        Processo            @relation(fields: [processoId], references: [id], onDelete: Cascade)
  causa           Causa?              @relation(fields: [causaId], references: [id])
  modelo          ModeloPeticao?      @relation(fields: [modeloId], references: [id], onDelete: SetNull)
  documento       Documento?          @relation(fields: [documentoId], references: [id], onDelete: SetNull)
  tenant          Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  criadoPor       Usuario?            @relation("PeticaoCriador", fields: [criadoPorId], references: [id])
  diligencias     Diligencia[]        @relation("DiligenciaPeticao")
  assinaturas     AssinaturaPeticao[]

  @@index([tenantId, processoId])
  @@index([causaId])
  @@index([modeloId])
  @@schema("magiclawyer")
}

model ModeloPeticao {
  id        String    @id @default(cuid())
  tenantId  String
  nome      String
  descricao String?
  conteudo  String // Template HTML/Markdown com placeholders
  categoria String? // Ex: "INICIAL", "CONTESTACAO", "RECURSO", "MANIFESTACAO"
  tipo      String? // Ex: "CIVEL", "TRABALHISTA", "CRIMINAL"
  variaveis Json? // Array de variáveis disponíveis: [{nome, tipo, descricao, obrigatorio}]
  publico   Boolean   @default(false) // Se pode ser compartilhado entre tenants
  ativo     Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  // Relacionamentos
  tenant   Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  peticoes Peticao[]

  @@index([tenantId, ativo])
  @@index([tenantId, categoria])
  @@index([tenantId, tipo])
  @@schema("magiclawyer")
}

model TipoPeticao {
  id        String    @id @default(cuid())
  tenantId  String? // NULL = tipo global (todos os tenants), preenchido = tipo customizado do tenant
  nome      String
  descricao String?
  categoria String? // Ex: "INICIAL", "RESPOSTA", "RECURSO", "EXECUCAO", "URGENTE", "OUTROS"
  ativo     Boolean   @default(true)
  global    Boolean   @default(false) // Se é um tipo global do sistema (tenantId NULL)
  ordem     Int       @default(0) // Para ordenação customizada
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  // Relacionamentos
  tenant Tenant? @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, nome]) // Garante unicidade por tenant (NULL conta como valor único)
  @@index([tenantId, ativo])
  @@index([tenantId, categoria])
  @@index([global, ativo]) // Para buscar tipos globais ativos
  @@schema("magiclawyer")
}

model AssinaturaPeticao {
  id                 String         @id @default(cuid())
  tenantId           String
  peticaoId          String
  usuarioId          String?
  assinanteNome      String
  assinanteDocumento String?
  assinanteEmail     String?
  assinanteTelefone  String?
  tipoAssinatura     AssinaturaTipo @default(GOV_BR)
  ipAssinatura       String?
  provedorAssinatura String? // "GOV_BR", "ICP_BRASIL_A1", "ICP_BRASIL_A3"
  tokenAssinatura    String? // Token de validação gov.br
  hashArquivo        String? // Hash SHA256 do documento assinado
  arquivoUrl         String? // URL do documento com assinatura
  metadados          Json? // Dados adicionais da assinatura (certificado, etc)
  status             String         @default("PENDENTE") // PENDENTE, ASSINADO, REJEITADO, EXPIRADO
  assinadaEm         DateTime?
  expiradaEm         DateTime?
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt

  // Relacionamentos
  peticao Peticao  @relation(fields: [peticaoId], references: [id], onDelete: Cascade)
  tenant  Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  usuario Usuario? @relation(fields: [usuarioId], references: [id])

  @@index([tenantId, peticaoId])
  @@index([usuarioId])
  @@index([status])
  @@schema("magiclawyer")
}

model Diligencia {
  id               String           @id @default(cuid())
  tenantId         String
  processoId       String?
  causaId          String?
  contratoId       String?
  peticaoId        String?
  documentoId      String?
  regimePrazoId    String?
  titulo           String
  tipo             String?
  status           DiligenciaStatus @default(PENDENTE)
  descricao        String?
  prazoPrevisto    DateTime?
  prazoConclusao   DateTime?
  responsavelId    String?
  criadoPorId      String?
  observacoes      String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  tenant           Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  processo         Processo?        @relation(fields: [processoId], references: [id], onDelete: SetNull)
  causa            Causa?           @relation(fields: [causaId], references: [id])
  contrato         Contrato?        @relation(fields: [contratoId], references: [id])
  peticao          Peticao?         @relation("DiligenciaPeticao", fields: [peticaoId], references: [id], onDelete: SetNull)
  documento        Documento?       @relation(fields: [documentoId], references: [id], onDelete: SetNull)
  regimePrazo      RegimePrazo?     @relation(fields: [regimePrazoId], references: [id])
  responsavel      Usuario?         @relation("DiligenciaResponsavel", fields: [responsavelId], references: [id])
  criadoPor        Usuario?         @relation("DiligenciaCriador", fields: [criadoPorId], references: [id])
  prazosVinculados ProcessoPrazo[]  @relation("DiligenciaPrazos")

  @@index([tenantId, status])
  @@index([processoId])
  @@index([causaId])
  @@index([contratoId])
  @@schema("magiclawyer")
}

model ContratoDocumento {
  id          String    @id @default(cuid())
  tenantId    String
  contratoId  String
  documentoId String
  processoId  String?
  causaId     String?
  observacoes String?
  createdAt   DateTime  @default(now())
  contrato    Contrato  @relation("ContratoDocumentoContrato", fields: [contratoId], references: [id], onDelete: Cascade)
  documento   Documento @relation("ContratoDocumentoDocumento", fields: [documentoId], references: [id], onDelete: Cascade)
  processo    Processo? @relation(fields: [processoId], references: [id])
  causa       Causa?    @relation(fields: [causaId], references: [id])
  tenant      Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([contratoId, documentoId])
  @@index([tenantId, contratoId])
  @@index([tenantId, documentoId])
  @@schema("magiclawyer")
}

model DocumentoVersao {
  id                   String          @id @default(cuid())
  tenantId             String
  documentoId          String
  numeroVersao         Int
  cloudinaryPublicId   String
  url                  String
  hashArquivo          String?
  assinaturaTipo       AssinaturaTipo?
  assinaturaReferenca  String?
  assinaturaRegistrada DateTime?
  assinadaPorId        String?
  uploadedById         String?
  observacoes          String?
  createdAt            DateTime        @default(now())
  updatedAt            DateTime        @updatedAt
  documento            Documento       @relation(fields: [documentoId], references: [id], onDelete: Cascade)
  tenant               Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  uploadedBy           Usuario?        @relation("DocumentoVersaoUploader", fields: [uploadedById], references: [id])
  assinadaPor          Usuario?        @relation("DocumentoVersaoAssinador", fields: [assinadaPorId], references: [id])

  @@unique([documentoId, numeroVersao])
  @@index([tenantId, documentoId])
  @@schema("magiclawyer")
}

model Contrato {
  id                       String              @id @default(cuid())
  tenantId                 String
  clienteId                String
  modeloId                 String?
  advogadoResponsavelId    String?
  responsavelUsuarioId     String?
  criadoPorId              String?
  processoId               String?
  dadosBancariosId         String? // Conta bancária para recebimento
  titulo                   String
  tipoId                   String?
  status                   ContratoStatus      @default(RASCUNHO)
  valor                    Decimal?            @db.Decimal(14, 2)
  moeda                    String?             @default("BRL")
  comissaoAdvogado         Decimal             @default(0.00) @db.Decimal(5, 2)
  percentualAcaoGanha      Decimal             @default(0.00) @db.Decimal(5, 2)
  valorAcaoGanha           Decimal             @default(0.00) @db.Decimal(14, 2)
  dataInicio               DateTime?
  dataFim                  DateTime?
  dataAssinatura           DateTime?
  resumo                   String?
  arquivoUrl               String?
  observacoes              String?
  deletedAt                DateTime?
  createdAt                DateTime            @default(now())
  updatedAt                DateTime            @updatedAt
  advogadoResponsavel      Advogado?           @relation("ContratoAdvogado", fields: [advogadoResponsavelId], references: [id])
  cliente                  Cliente             @relation(fields: [clienteId], references: [id], onDelete: Cascade)
  criadoPor                Usuario?            @relation("ContratoCriador", fields: [criadoPorId], references: [id])
  modelo                   ModeloContrato?     @relation(fields: [modeloId], references: [id])
  processo                 Processo?           @relation(fields: [processoId], references: [id])
  responsavelUsuario       Usuario?            @relation("ContratoResponsavel", fields: [responsavelUsuarioId], references: [id])
  tenant                   Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tipo                     TipoContrato?       @relation(fields: [tipoId], references: [id])
  dadosBancarios           DadosBancarios?     @relation(fields: [dadosBancariosId], references: [id])
  documentos               Documento[]         @relation("ContratoDocumentos")
  documentosCompartilhados ContratoDocumento[] @relation("ContratoDocumentoContrato")
  faturas                  Fatura[]
  honorarios               ContratoHonorario[]
  parcelas                 ContratoParcela[]
  Diligencia               Diligencia[]

  @@index([clienteId])
  @@index([status])
  @@index([tipoId])
  @@index([dadosBancariosId])
  @@index([tenantId, deletedAt])
  @@schema("magiclawyer")
}

model ContratoHonorario {
  id                 String                @id @default(cuid())
  tenantId           String
  contratoId         String
  advogadoId         String? // Advogado específico (NULL = honorário geral do contrato)
  dadosBancariosId   String? // Conta específica para recebimento (herda do contrato se NULL)
  tipo               ContratoHonorarioTipo
  valorFixo          Decimal?              @db.Decimal(14, 2)
  percentualSucesso  Decimal?              @db.Decimal(5, 2)
  valorMinimoSucesso Decimal?              @db.Decimal(14, 2)
  baseCalculo        String?
  observacoes        String?
  visibilidade       HonorarioVisibilidade @default(PRIVADO) // PRIVADO = só o advogado vê, PUBLICO = todos veem
  createdAt          DateTime              @default(now())
  updatedAt          DateTime              @updatedAt
  contrato           Contrato              @relation(fields: [contratoId], references: [id], onDelete: Cascade)
  tenant             Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  advogado           Advogado?             @relation(fields: [advogadoId], references: [id])
  dadosBancarios     DadosBancarios?       @relation(fields: [dadosBancariosId], references: [id])

  @@index([tenantId, tipo])
  @@index([contratoId])
  @@index([advogadoId])
  @@index([dadosBancariosId])
  @@schema("magiclawyer")
}

model ContratoParcela {
  id                     String                @id @default(cuid())
  tenantId               String
  contratoId             String
  dadosBancariosId       String? // Conta específica para esta parcela (herda do contrato se NULL)
  numeroParcela          Int
  titulo                 String?
  descricao              String?
  valor                  Decimal               @db.Decimal(14, 2)
  dataVencimento         DateTime
  dataPagamento          DateTime?
  status                 ContratoParcelaStatus @default(PENDENTE)
  formaPagamento         String?
  comprovanteDocumentoId String?
  responsavelUsuarioId   String?
  asaasPaymentId         String? // ID do pagamento no Asaas
  dadosPagamento         Json?
  createdAt              DateTime              @default(now())
  updatedAt              DateTime              @updatedAt
  contrato               Contrato              @relation(fields: [contratoId], references: [id], onDelete: Cascade)
  tenant                 Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  dadosBancarios         DadosBancarios?       @relation(fields: [dadosBancariosId], references: [id])
  comprovanteDocumento   Documento?            @relation("ContratoParcelaComprovante", fields: [comprovanteDocumentoId], references: [id])
  responsavelUsuario     Usuario?              @relation(fields: [responsavelUsuarioId], references: [id])

  @@unique([contratoId, numeroParcela])
  @@index([tenantId, status])
  @@index([tenantId, dataVencimento])
  @@index([dadosBancariosId])
  @@index([asaasPaymentId])
  @@schema("magiclawyer")
}

model ModeloContrato {
  id        String        @id @default(cuid())
  tenantId  String
  tipoId    String?
  nome      String
  descricao String?
  categoria String?
  idioma    String?       @default("pt-BR")
  conteudo  String
  variaveis Json?
  publico   Boolean       @default(false)
  ativo     Boolean       @default(true)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  contratos Contrato[]
  tenant    Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tipo      TipoContrato? @relation(fields: [tipoId], references: [id])

  @@index([tipoId])
  @@schema("magiclawyer")
}

model Tarefa {
  id               String             @id @default(cuid())
  tenantId         String
  boardId          String?
  columnId         String?
  titulo           String
  descricao        String?
  numeroSequencial Int?
  status           TarefaStatus       @default(PENDENTE)
  prioridade       TarefaPrioridade   @default(MEDIA)
  processoId       String?
  clienteId        String?
  categoriaId      String?
  responsavelId    String?
  criadoPorId      String?
  dataLimite       DateTime?
  dataInicio       DateTime?
  completedAt      DateTime?
  lembreteEm       DateTime?
  estimativaHoras  Decimal?           @db.Decimal(8, 2)
  horasGastas      Decimal?           @db.Decimal(8, 2)
  ordem            Int                @default(0)
  cor              String?
  arquivada        Boolean            @default(false)
  tarefaPaiId      String?
  deletedAt        DateTime?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  categoria        CategoriaTarefa?   @relation(fields: [categoriaId], references: [id])
  cliente          Cliente?           @relation("TarefaCliente", fields: [clienteId], references: [id])
  criadoPor        Usuario?           @relation("TarefasCriadas", fields: [criadoPorId], references: [id])
  processo         Processo?          @relation(fields: [processoId], references: [id])
  responsavel      Usuario?           @relation("TarefasResponsaveis", fields: [responsavelId], references: [id])
  tenant           Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  board            Board?             @relation(fields: [boardId], references: [id], onDelete: SetNull)
  column           BoardColumn?       @relation(fields: [columnId], references: [id], onDelete: SetNull)
  tarefaPai        Tarefa?            @relation("TarefaSubtarefas", fields: [tarefaPaiId], references: [id], onDelete: SetNull)
  subtarefas       Tarefa[]           @relation("TarefaSubtarefas")
  checklists       TarefaChecklist[]
  comentarios      TarefaComentario[]
  anexos           TarefaAnexo[]
  atividades       TarefaAtividade[]
  tags             TarefaTagRelacao[]
  observadores     TarefaWatcher[]

  @@index([tenantId, status])
  @@index([tenantId, responsavelId])
  @@index([tenantId, dataLimite])
  @@index([tenantId, deletedAt])
  @@index([tenantId, boardId, columnId, ordem])
  @@index([boardId, columnId])
  @@index([tarefaPaiId])
  @@schema("magiclawyer")
}

// ============================================
// SISTEMA KANBAN COMPLETO
// ============================================

model Board {
  id           String            @id @default(cuid())
  tenantId     String
  nome         String
  descricao    String?
  tipo         BoardTipo         @default(PESSOAL)
  icone        String?
  cor          String?
  favorito     Boolean           @default(false)
  visibilidade BoardVisibilidade @default(EQUIPE)
  ordem        Int               @default(0)
  ativo        Boolean           @default(true)
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  tenant       Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  colunas      BoardColumn[]
  tarefas      Tarefa[]

  @@index([tenantId, ativo])
  @@index([tenantId, tipo])
  @@schema("magiclawyer")
}

model BoardColumn {
  id        String   @id @default(cuid())
  tenantId  String
  boardId   String
  nome      String
  cor       String?
  ordem     Int      @default(0)
  limite    Int? // Limite WIP (Work In Progress)
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  board     Board    @relation(fields: [boardId], references: [id], onDelete: Cascade)
  tarefas   Tarefa[]

  @@unique([boardId, ordem])
  @@index([tenantId, boardId])
  @@schema("magiclawyer")
}

model TarefaChecklist {
  id          String    @id @default(cuid())
  tenantId    String
  tarefaId    String
  titulo      String
  concluida   Boolean   @default(false)
  concluidaEm DateTime?
  ordem       Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  tenant      Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tarefa      Tarefa    @relation(fields: [tarefaId], references: [id], onDelete: Cascade)

  @@index([tenantId, tarefaId])
  @@index([tarefaId, ordem])
  @@schema("magiclawyer")
}

model TarefaComentario {
  id        String   @id @default(cuid())
  tenantId  String
  tarefaId  String
  usuarioId String
  conteudo  String
  editado   Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tarefa    Tarefa   @relation(fields: [tarefaId], references: [id], onDelete: Cascade)
  usuario   Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@index([tenantId, tarefaId])
  @@index([tarefaId, createdAt])
  @@schema("magiclawyer")
}

model TarefaAnexo {
  id          String   @id @default(cuid())
  tenantId    String
  tarefaId    String
  nome        String
  url         String
  tamanho     Int? // bytes
  contentType String?
  publicId    String? // Cloudinary
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tarefa      Tarefa   @relation(fields: [tarefaId], references: [id], onDelete: Cascade)

  @@index([tenantId, tarefaId])
  @@schema("magiclawyer")
}

model TarefaTag {
  id        String             @id @default(cuid())
  tenantId  String
  nome      String
  cor       String             @default("#3B82F6")
  ativo     Boolean            @default(true)
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  tenant    Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tarefas   TarefaTagRelacao[]

  @@unique([tenantId, nome])
  @@index([tenantId, ativo])
  @@schema("magiclawyer")
}

model TarefaTagRelacao {
  id        String    @id @default(cuid())
  tenantId  String
  tarefaId  String
  tagId     String
  createdAt DateTime  @default(now())
  tenant    Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tarefa    Tarefa    @relation(fields: [tarefaId], references: [id], onDelete: Cascade)
  tag       TarefaTag @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([tarefaId, tagId])
  @@index([tenantId, tarefaId])
  @@index([tenantId, tagId])
  @@schema("magiclawyer")
}

model TarefaAtividade {
  id           String   @id @default(cuid())
  tenantId     String
  tarefaId     String
  usuarioId    String
  tipo         String // CRIOU, EDITOU, COMENTOU, MOVEU, ANEXOU, etc
  descricao    String
  dadosAntigos Json?
  dadosNovos   Json?
  createdAt    DateTime @default(now())
  tenant       Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tarefa       Tarefa   @relation(fields: [tarefaId], references: [id], onDelete: Cascade)
  usuario      Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@index([tenantId, tarefaId, createdAt])
  @@schema("magiclawyer")
}

model TarefaWatcher {
  id        String   @id @default(cuid())
  tenantId  String
  tarefaId  String
  usuarioId String
  createdAt DateTime @default(now())
  tarefa    Tarefa   @relation(fields: [tarefaId], references: [id], onDelete: Cascade)
  usuario   Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tarefaId, usuarioId])
  @@index([tenantId, usuarioId])
  @@schema("magiclawyer")
}

model Plano {
  id              String               @id @default(cuid())
  nome            String
  slug            String               @unique
  descricao       String?
  valorMensal     Decimal?             @db.Decimal(10, 2)
  valorAnual      Decimal?             @db.Decimal(10, 2)
  moeda           String               @default("BRL")
  limiteUsuarios  Int?
  limiteProcessos Int?
  limiteStorageMb Int?
  periodoTeste    Int                  @default(14) // dias grátis
  recursos        Json?
  ativo           Boolean              @default(true)
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  subscriptions   TenantSubscription[]
  modulos         PlanoModulo[]
  versoes         PlanoVersao[]
  tenants         Tenant[]

  @@schema("magiclawyer")
}

model Modulo {
  id            String              @id @default(cuid())
  slug          String              @unique
  nome          String
  descricao     String?
  categoria     String?
  icone         String?
  ordem         Int?
  ativo         Boolean             @default(true)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  planoModulos  PlanoModulo[]
  versaoModulos PlanoVersaoModulo[]

  @@index([categoria])
  @@schema("magiclawyer")
}

model PlanoModulo {
  id         String   @id @default(cuid())
  planoId    String
  moduloId   String
  habilitado Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  plano      Plano    @relation(fields: [planoId], references: [id], onDelete: Cascade)
  modulo     Modulo   @relation(fields: [moduloId], references: [id])

  @@unique([planoId, moduloId])
  @@index([moduloId])
  @@schema("magiclawyer")
}

model PlanoVersao {
  id             String               @id @default(cuid())
  planoId        String
  numero         Int
  status         PlanoVersaoStatus    @default(DRAFT)
  titulo         String?
  descricao      String?
  criadoPorId    String?
  publicadoEm    DateTime?
  publicadoPorId String?
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  plano          Plano                @relation(fields: [planoId], references: [id], onDelete: Cascade)
  modulos        PlanoVersaoModulo[]
  criadoPor      Usuario?             @relation("PlanoVersaoCriador", fields: [criadoPorId], references: [id])
  publicadoPor   Usuario?             @relation("PlanoVersaoPublicador", fields: [publicadoPorId], references: [id])
  assinaturas    TenantSubscription[] @relation("PlanoVersaoAssinaturas")

  @@unique([planoId, numero])
  @@schema("magiclawyer")
}

model PlanoVersaoModulo {
  id            String      @id @default(cuid())
  planoVersaoId String
  moduloId      String
  habilitado    Boolean     @default(true)
  planoVersao   PlanoVersao @relation(fields: [planoVersaoId], references: [id], onDelete: Cascade)
  modulo        Modulo      @relation(fields: [moduloId], references: [id])

  @@unique([planoVersaoId, moduloId])
  @@index([moduloId])
  @@schema("magiclawyer")
}

model TenantSubscription {
  id                     String             @id @default(cuid())
  tenantId               String             @unique
  planoId                String?
  planoVersaoId          String?
  status                 SubscriptionStatus @default(TRIAL)
  dataInicio             DateTime           @default(now())
  dataFim                DateTime?
  renovaEm               DateTime?
  trialEndsAt            DateTime?
  externalCustomerId     String?
  externalSubscriptionId String?
  // Campos específicos do Asaas
  asaasCustomerId        String? // ID do cliente no Asaas
  asaasSubscriptionId    String? // ID da assinatura no Asaas
  asaasPaymentId         String? // ID do último pagamento no Asaas
  metadata               Json?
  createdAt              DateTime           @default(now())
  updatedAt              DateTime           @updatedAt
  faturas                Fatura[]
  plano                  Plano?             @relation(fields: [planoId], references: [id])
  planoVersao            PlanoVersao?       @relation("PlanoVersaoAssinaturas", fields: [planoVersaoId], references: [id])
  tenant                 Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([asaasCustomerId])
  @@index([planoVersaoId])
  @@index([asaasSubscriptionId])
  @@schema("magiclawyer")
}

model Fatura {
  id                String              @id @default(cuid())
  tenantId          String
  subscriptionId    String?
  contratoId        String?
  numero            String?
  descricao         String?
  valor             Decimal             @db.Decimal(12, 2)
  moeda             String              @default("BRL")
  status            InvoiceStatus       @default(RASCUNHO)
  comissaoAdvogado  Decimal             @default(0.00) @db.Decimal(5, 2)
  valorComissao     Decimal             @default(0.00) @db.Decimal(14, 2)
  tipoComissao      TipoComissao        @default(HONORARIOS)
  periodoInicio     DateTime?
  periodoFim        DateTime?
  vencimento        DateTime?
  pagoEm            DateTime?
  externalInvoiceId String?
  urlBoleto         String?
  metadata          Json?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  contrato          Contrato?           @relation(fields: [contratoId], references: [id])
  subscription      TenantSubscription? @relation(fields: [subscriptionId], references: [id])
  tenant            Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  pagamentos        Pagamento[]

  @@unique([tenantId, numero])
  @@index([tenantId, status])
  @@schema("magiclawyer")
}

model Pagamento {
  id               String              @id @default(cuid())
  tenantId         String
  faturaId         String
  valor            Decimal             @db.Decimal(12, 2)
  status           PaymentStatus       @default(PENDENTE)
  comissaoAdvogado Decimal             @default(0.00) @db.Decimal(5, 2)
  valorComissao    Decimal             @default(0.00) @db.Decimal(14, 2)
  pagoParaAdvogado Boolean             @default(false)
  metodo           String?
  transacaoId      String?
  autorizadoEm     DateTime?
  confirmadoEm     DateTime?
  estornadoEm      DateTime?
  detalhes         Json?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  fatura           Fatura              @relation(fields: [faturaId], references: [id], onDelete: Cascade)
  tenant           Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  comissoes        PagamentoComissao[]

  @@index([faturaId])
  @@index([tenantId, status])
  @@index([tenantId, createdAt])
  @@schema("magiclawyer")
}

model PagamentoComissao {
  id                 String       @id @default(cuid())
  tenantId           String
  pagamentoId        String
  advogadoId         String
  valorComissao      Decimal      @db.Decimal(14, 2)
  percentualComissao Decimal      @db.Decimal(5, 2)
  tipoComissao       TipoComissao @default(HONORARIOS)
  status             String       @default("PENDENTE")
  dataPagamento      DateTime?
  observacoes        String?
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
  advogado           Advogado     @relation(fields: [advogadoId], references: [id], onDelete: Cascade)
  pagamento          Pagamento    @relation(fields: [pagamentoId], references: [id], onDelete: Cascade)
  tenant             Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([pagamentoId, advogadoId])
  @@index([tenantId, advogadoId])
  @@index([tenantId, status])
  @@index([pagamentoId])
  @@schema("magiclawyer")
}

model AuditLog {
  id             String   @id @default(cuid())
  tenantId       String
  usuarioId      String?
  acao           String
  entidade       String
  entidadeId     String?
  dados          Json?
  previousValues Json?
  changedFields  String[]
  ip             String?
  userAgent      String?
  createdAt      DateTime @default(now())
  tenant         Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  usuario        Usuario? @relation(fields: [usuarioId], references: [id])

  @@index([tenantId, entidade])
  @@index([tenantId, createdAt])
  @@index([tenantId, usuarioId])
  @@index([tenantId, acao])
  @@index([tenantId, entidade, entidadeId])
  @@map("audit_logs")
  @@schema("audit")
}

model Evento {
  id                    String               @id @default(cuid())
  tenantId              String
  titulo                String
  descricao             String?
  tipo                  EventoTipo           @default(REUNIAO)
  status                EventoStatus         @default(AGENDADO)
  dataInicio            DateTime
  dataFim               DateTime
  local                 String?
  participantes         String[]
  processoId            String?
  clienteId             String?
  advogadoResponsavelId String?
  criadoPorId           String?
  recorrencia           EventoRecorrencia    @default(NENHUMA)
  recorrenciaFim        DateTime?
  googleEventId         String?
  googleCalendarId      String?
  lembreteMinutos       Int?
  observacoes           String?
  createdAt             DateTime             @default(now())
  updatedAt             DateTime             @updatedAt
  advogadoResponsavel   Advogado?            @relation(fields: [advogadoResponsavelId], references: [id])
  cliente               Cliente?             @relation(fields: [clienteId], references: [id])
  criadoPor             Usuario?             @relation(fields: [criadoPorId], references: [id])
  processo              Processo?            @relation(fields: [processoId], references: [id])
  tenant                Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  confirmacoes          EventoParticipante[]

  @@index([tenantId, dataInicio])
  @@index([tenantId, dataFim])
  @@index([tenantId, status])
  @@index([processoId])
  @@index([clienteId])
  @@index([advogadoResponsavelId])
  @@index([googleEventId])
  @@schema("magiclawyer")
}

model EventoParticipante {
  id                String                  @id @default(cuid())
  tenantId          String
  eventoId          String
  participanteEmail String
  participanteNome  String?
  status            EventoConfirmacaoStatus @default(PENDENTE)
  confirmadoEm      DateTime?
  observacoes       String?
  createdAt         DateTime                @default(now())
  updatedAt         DateTime                @updatedAt
  evento            Evento                  @relation(fields: [eventoId], references: [id], onDelete: Cascade)
  tenant            Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([eventoId, participanteEmail])
  @@index([tenantId, eventoId])
  @@index([tenantId, status])
  @@index([participanteEmail])
  @@schema("magiclawyer")
}

model DocumentoAssinatura {
  id                    String                    @id @default(cuid())
  tenantId              String
  documentoId           String
  processoId            String?
  clienteId             String
  advogadoResponsavelId String?
  titulo                String
  descricao             String?
  status                DocumentoAssinaturaStatus @default(PENDENTE)
  urlDocumento          String
  urlAssinado           String?
  clicksignDocumentId   String?
  clicksignSignerId     String?
  dataEnvio             DateTime?
  dataAssinatura        DateTime?
  dataExpiracao         DateTime?
  observacoes           String?
  criadoPorId           String?
  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt
  advogadoResponsavel   Advogado?                 @relation(fields: [advogadoResponsavelId], references: [id])
  cliente               Cliente                   @relation(fields: [clienteId], references: [id], onDelete: Cascade)
  criadoPor             Usuario?                  @relation(fields: [criadoPorId], references: [id])
  documento             Documento                 @relation(fields: [documentoId], references: [id], onDelete: Cascade)
  processo              Processo?                 @relation(fields: [processoId], references: [id])
  tenant                Tenant                    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, status])
  @@index([tenantId, clienteId])
  @@index([processoId])
  @@index([clicksignDocumentId])
  @@schema("magiclawyer")
}

model Julgamento {
  id              String    @id @default(cuid())
  tenantId        String
  juizId          String
  processoId      String?
  titulo          String
  descricao       String?
  dataJulgamento  DateTime
  tipoJulgamento  String
  resultado       String?
  valorCausa      Decimal?  @db.Decimal(14, 2)
  valorCondenacao Decimal?  @db.Decimal(14, 2)
  observacoes     String?
  pontosPositivos String[]
  pontosNegativos String[]
  estrategias     String[]
  recomendacoes   String[]
  tags            String[]
  isPublico       Boolean   @default(false)
  criadoPorId     String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  criadoPor       Usuario?  @relation("JulgamentoCriador", fields: [criadoPorId], references: [id])
  juiz            Juiz      @relation(fields: [juizId], references: [id], onDelete: Cascade)
  processo        Processo? @relation(fields: [processoId], references: [id])
  tenant          Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("Julgamentos")
  @@schema("magiclawyer")
}

model AnaliseJuiz {
  id            String   @id @default(cuid())
  tenantId      String
  juizId        String
  titulo        String
  descricao     String?
  tipoAnalise   String
  dados         Json
  conclusoes    String[]
  recomendacoes String[]
  isPublico     Boolean  @default(false)
  criadoPorId   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  criadoPor     Usuario? @relation("AnaliseJuizCriador", fields: [criadoPorId], references: [id])
  juiz          Juiz     @relation(fields: [juizId], references: [id], onDelete: Cascade)
  tenant        Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("AnalisesJuiz")
  @@schema("magiclawyer")
}

model FavoritoJuiz {
  id          String   @id @default(cuid())
  tenantId    String
  juizId      String
  usuarioId   String
  observacoes String?
  tags        String[]
  createdAt   DateTime @default(now())
  juiz        Juiz     @relation(fields: [juizId], references: [id], onDelete: Cascade)
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  usuario     Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([tenantId, juizId, usuarioId])
  @@map("FavoritosJuiz")
  @@schema("magiclawyer")
}

model AcessoJuiz {
  id          String   @id @default(cuid())
  tenantId    String
  juizId      String
  usuarioId   String
  tipoAcesso  String
  dataAcesso  DateTime @default(now())
  ipAddress   String?
  userAgent   String?
  observacoes String?
  juiz        Juiz     @relation(fields: [juizId], references: [id], onDelete: Cascade)
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  usuario     Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@map("AcessosJuiz")
  @@schema("magiclawyer")
}

model PacoteJuiz {
  id              String                 @id @default(cuid())
  nome            String                 @unique
  descricao       String?
  preco           Decimal                @db.Decimal(10, 2)
  moeda           String                 @default("BRL")
  duracaoDias     Int?
  limiteUsuarios  Int?
  limiteConsultas Int?
  isPublico       Boolean                @default(true)
  status          StatusPacoteJuiz       @default(ATIVO)
  ordemExibicao   Int                    @default(0)
  cor             String                 @default("primary")
  icone           String?
  superAdminId    String?
  createdAt       DateTime               @default(now())
  updatedAt       DateTime               @updatedAt
  assinaturas     AssinaturaPacoteJuiz[]
  juizes          PacoteJuizItem[]
  superAdmin      SuperAdmin?            @relation("SuperAdminPacoteJuiz", fields: [superAdminId], references: [id])

  @@index([status])
  @@index([superAdminId])
  @@map("PacotesJuiz")
  @@schema("magiclawyer")
}

model PacoteJuizItem {
  id            String     @id @default(cuid())
  pacoteId      String
  juizId        String
  ordemExibicao Int        @default(0)
  createdAt     DateTime   @default(now())
  juiz          Juiz       @relation("JuizPacote", fields: [juizId], references: [id], onDelete: Cascade)
  pacote        PacoteJuiz @relation(fields: [pacoteId], references: [id], onDelete: Cascade)

  @@unique([pacoteId, juizId])
  @@index([pacoteId])
  @@index([juizId])
  @@map("PacoteJuizItems")
  @@schema("magiclawyer")
}

model AssinaturaPacoteJuiz {
  id                  String     @id @default(cuid())
  tenantId            String
  pacoteId            String
  status              String
  dataInicio          DateTime   @default(now())
  dataFim             DateTime?
  renovacaoAutomatica Boolean    @default(true)
  precoPago           Decimal    @db.Decimal(10, 2)
  formaPagamento      String?
  observacoes         String?
  createdAt           DateTime   @default(now())
  updatedAt           DateTime   @updatedAt
  pacote              PacoteJuiz @relation(fields: [pacoteId], references: [id], onDelete: Cascade)
  tenant              Tenant     @relation("TenantAssinaturaPacote", fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([pacoteId])
  @@index([status])
  @@map("AssinaturasPacoteJuiz")
  @@schema("magiclawyer")
}

model ConfiguracaoPreco {
  id           String      @id @default(cuid())
  chave        String      @unique
  valor        String
  tipo         String
  descricao    String?
  categoria    String
  isAtivo      Boolean     @default(true)
  superAdminId String?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  superAdmin   SuperAdmin? @relation("SuperAdminConfiguracao", fields: [superAdminId], references: [id])

  @@index([chave])
  @@index([categoria])
  @@map("ConfiguracoesPreco")
  @@schema("magiclawyer")
}

model Ticket {
  id          String             @id @default(cuid())
  title       String
  description String?
  status      TicketStatus       @default(OPEN)
  priority    TicketPriority     @default(MEDIUM)
  category    TicketCategory     @default(GENERAL)
  userId      String
  tenantId    String
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  closedAt    DateTime?
  attachments TicketAttachment[]
  messages    TicketMessage[]
  tenant      Tenant             @relation("TenantTickets", fields: [tenantId], references: [id], onDelete: Cascade)
  user        Usuario            @relation("UserTickets", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([tenantId])
  @@index([status])
  @@index([priority])
  @@index([createdAt])
  @@map("tickets")
  @@schema("support")
}

model TicketMessage {
  id         String   @id @default(cuid())
  content    String
  isInternal Boolean  @default(false)
  ticketId   String
  userId     String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  ticket     Ticket   @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  user       Usuario  @relation("UserMessages", fields: [userId], references: [id], onDelete: Cascade)

  @@index([ticketId])
  @@index([userId])
  @@index([createdAt])
  @@map("ticket_messages")
  @@schema("support")
}

model TicketAttachment {
  id           String   @id @default(cuid())
  filename     String
  originalName String
  mimeType     String
  size         Int
  url          String
  ticketId     String
  userId       String
  createdAt    DateTime @default(now())
  ticket       Ticket   @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  user         Usuario  @relation("UserAttachments", fields: [userId], references: [id], onDelete: Cascade)

  @@index([ticketId])
  @@index([userId])
  @@map("ticket_attachments")
  @@schema("support")
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  ADVOGADO
  SECRETARIA
  FINANCEIRO
  CLIENTE

  @@schema("magiclawyer")
}

enum TenantStatus {
  ACTIVE
  SUSPENDED
  CANCELLED

  @@schema("magiclawyer")
}

enum TipoPessoa {
  FISICA
  JURIDICA

  @@schema("magiclawyer")
}

enum TipoEndereco {
  MATRIZ
  FILIAL
  ESCRITORIO
  RESIDENCIAL
  COMERCIAL
  CORRESPONDENCIA

  @@schema("magiclawyer")
}

enum ProcessoStatus {
  RASCUNHO
  EM_ANDAMENTO
  SUSPENSO
  ENCERRADO
  ARQUIVADO

  @@schema("magiclawyer")
}

enum ProcessoGrau {
  PRIMEIRO
  SEGUNDO
  SUPERIOR

  @@schema("magiclawyer")
}

enum ProcessoFase {
  PETICAO_INICIAL
  CITACAO
  INSTRUCAO
  SENTENCA
  RECURSO
  EXECUCAO

  @@schema("magiclawyer")
}

enum ProcessoPolo {
  AUTOR
  REU
  TERCEIRO
  MINISTERIO_PUBLICO
  ASSISTENTE

  @@schema("magiclawyer")
}

enum ProcessoPrazoStatus {
  ABERTO
  CONCLUIDO
  PRORROGADO
  CANCELADO

  @@schema("magiclawyer")
}

enum RegimePrazoTipo {
  JUSTICA_COMUM
  JUIZADO_ESPECIAL
  TRABALHISTA
  FEDERAL
  OUTRO

  @@schema("magiclawyer")
}

enum TipoFeriado {
  NACIONAL
  ESTADUAL
  MUNICIPAL
  JUDICIARIO

  @@schema("magiclawyer")
}

enum DiligenciaStatus {
  PENDENTE
  EM_ANDAMENTO
  CONCLUIDA
  CANCELADA

  @@schema("magiclawyer")
}

enum PeticaoStatus {
  RASCUNHO
  EM_ANALISE
  PROTOCOLADA
  INDEFERIDA
  ARQUIVADA

  @@schema("magiclawyer")
}

enum MovimentacaoTipo {
  ANDAMENTO
  PRAZO
  INTIMACAO
  AUDIENCIA
  ANEXO
  OUTRO

  @@schema("magiclawyer")
}

enum AssinaturaTipo {
  MANUAL
  DIGITAL
  ICP_BRASIL
  GOV_BR
  OUTRO

  @@schema("magiclawyer")
}

enum ContratoStatus {
  RASCUNHO
  ATIVO
  SUSPENSO
  ENCERRADO
  CANCELADO

  @@schema("magiclawyer")
}

enum ContratoHonorarioTipo {
  FIXO
  SUCESSO
  HIBRIDO

  @@schema("magiclawyer")
}

enum HonorarioVisibilidade {
  PRIVADO // Apenas o advogado vinculado vê
  PUBLICO // Todos os advogados do contrato veem

  @@schema("magiclawyer")
}

enum ContratoParcelaStatus {
  PENDENTE
  PAGA
  ATRASADA
  CANCELADA

  @@schema("magiclawyer")
}

enum TarefaStatus {
  PENDENTE
  EM_ANDAMENTO
  CONCLUIDA
  CANCELADA

  @@schema("magiclawyer")
}

enum TarefaPrioridade {
  BAIXA
  MEDIA
  ALTA
  CRITICA

  @@schema("magiclawyer")
}

enum NotificacaoTipo {
  SISTEMA
  PRAZO
  DOCUMENTO
  MENSAGEM
  FINANCEIRO
  OUTRO

  @@schema("magiclawyer")
}

enum NotificacaoPrioridade {
  BAIXA
  MEDIA
  ALTA
  CRITICA

  @@schema("magiclawyer")
}

enum NotificacaoStatus {
  NAO_LIDA
  LIDA
  ARQUIVADA

  @@schema("magiclawyer")
}

enum NotificacaoCanal {
  IN_APP
  EMAIL
  SMS
  WHATSAPP
  TELEGRAM
  PUSH

  @@schema("magiclawyer")
}

enum TenantPermission {
  CONFIGURACOES_ESCRITORIO
  EQUIPE_GERENCIAR
  FINANCEIRO_GERENCIAR

  @@schema("magiclawyer")
}

enum SubscriptionStatus {
  TRIAL
  ATIVA
  INADIMPLENTE
  CANCELADA
  SUSPENSA

  @@schema("magiclawyer")
}

enum PlanoVersaoStatus {
  DRAFT
  REVIEW
  PUBLISHED
  ARCHIVED

  @@schema("magiclawyer")
}

enum InvoiceStatus {
  RASCUNHO
  ABERTA
  PAGA
  VENCIDA
  CANCELADA

  @@schema("magiclawyer")
}

enum PaymentStatus {
  PENDENTE
  PROCESSANDO
  PAGO
  FALHOU
  ESTORNADO

  @@schema("magiclawyer")
}

enum DocumentoOrigem {
  CLIENTE
  ESCRITORIO
  SISTEMA

  @@schema("magiclawyer")
}

enum ProcuracaoEmitidaPor {
  ESCRITORIO
  ADVOGADO

  @@schema("magiclawyer")
}

enum ProcuracaoStatus {
  RASCUNHO
  PENDENTE_ASSINATURA
  VIGENTE
  REVOGADA
  EXPIRADA

  @@schema("magiclawyer")
}

enum TicketStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED

  @@schema("magiclawyer")
}

enum TicketPriority {
  LOW
  MEDIUM
  HIGH
  URGENT

  @@schema("magiclawyer")
}

enum TicketCategory {
  TECHNICAL
  BILLING
  FEATURE_REQUEST
  BUG_REPORT
  GENERAL

  @@schema("magiclawyer")
}

enum EventoTipo {
  AUDIENCIA
  REUNIAO
  CONSULTA
  PRAZO
  LEMBRETE
  OUTRO

  @@schema("magiclawyer")
}

enum EventoStatus {
  AGENDADO
  CONFIRMADO
  CANCELADO
  REALIZADO
  ADIADO

  @@schema("magiclawyer")
}

enum EventoConfirmacaoStatus {
  PENDENTE
  CONFIRMADO
  RECUSADO
  TALVEZ

  @@schema("magiclawyer")
}

enum EventoRecorrencia {
  NENHUMA
  DIARIA
  SEMANAL
  MENSAL
  ANUAL

  @@schema("magiclawyer")
}

enum DocumentoAssinaturaStatus {
  PENDENTE
  ASSINADO
  REJEITADO
  EXPIRADO
  CANCELADO

  @@schema("magiclawyer")
}

enum TipoComissao {
  HONORARIOS
  ACAO_GANHA
  CUSTAS
  OUTROS

  @@schema("magiclawyer")
}

enum JuizStatus {
  ATIVO
  INATIVO
  APOSENTADO
  SUSPENSO

  @@schema("magiclawyer")
}

enum EspecialidadeJuridica {
  CIVIL
  CRIMINAL
  TRABALHISTA
  FAMILIA
  TRIBUTARIO
  ADMINISTRATIVO
  EMPRESARIAL
  CONSUMIDOR
  AMBIENTAL
  ELETORAL
  MILITAR
  PREVIDENCIARIO
  CONSTITUCIONAL
  INTERNACIONAL
  OUTROS

  @@schema("magiclawyer")
}

enum JuizNivel {
  JUIZ_SUBSTITUTO
  JUIZ_TITULAR
  DESEMBARGADOR
  MINISTRO
  OUTROS

  @@schema("magiclawyer")
}

enum StatusPacoteJuiz {
  ATIVO
  INATIVO
  PROMOCIONAL

  @@schema("magiclawyer")
}

enum BoardTipo {
  PESSOAL
  EQUIPE
  PROJETO
  PROCESSO
  CLIENTE

  @@schema("magiclawyer")
}

enum BoardVisibilidade {
  PRIVADO
  EQUIPE
  PUBLICO

  @@schema("magiclawyer")
}

enum AsaasAmbiente {
  SANDBOX
  PRODUCAO

  @@schema("magiclawyer")
}

// ============================================
// MODELOS DE PROCURAÇÃO
// ============================================

model ModeloProcuracao {
  id        String    @id @default(cuid())
  tenantId  String
  nome      String
  descricao String?
  conteudo  String // Template HTML com placeholders
  categoria String? // Ex: "PREFERITURA", "PESSOA_FISICA", "CRIMINAL"
  ativo     Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  // Relacionamentos
  tenant      Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  procuracoes Procuracao[]

  @@index([tenantId, ativo])
  @@index([tenantId, categoria])
  @@schema("magiclawyer")
}

// ============================================
// DOCUMENTOS DE PROCURAÇÃO
// ============================================

model DocumentoProcuracao {
  id           String   @id @default(cuid())
  tenantId     String
  procuracaoId String
  fileName     String // Nome personalizado do arquivo
  originalName String // Nome original do arquivo
  description  String? // Descrição opcional
  tipo         String // Tipo do documento: documento_original, procuracao_assinada, etc.
  url          String // URL do arquivo no Cloudinary
  publicId     String // Public ID do Cloudinary para deleção
  size         Int // Tamanho do arquivo em bytes
  mimeType     String // Tipo MIME do arquivo
  uploadedBy   String // ID do usuário que fez o upload
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relacionamentos
  tenant     Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  procuracao Procuracao @relation(fields: [procuracaoId], references: [id], onDelete: Cascade)
  uploader   Usuario    @relation("DocumentoProcuracaoUploader", fields: [uploadedBy], references: [id])

  @@index([tenantId, procuracaoId])
  @@index([tenantId, tipo])
  @@index([uploadedBy])
  @@schema("magiclawyer")
}

// ============================================
// BANCOS
// ============================================

model Banco {
  id           String    @id @default(cuid())
  codigo       String    @unique
  nome         String
  nomeCompleto String?
  site         String?
  telefone     String?
  cnpj         String?
  ispb         String? // Código ISPB para PIX
  ativo        Boolean   @default(true)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  deletedAt    DateTime?

  // Relacionamentos
  dadosBancarios DadosBancarios[]

  @@index([codigo])
  @@index([ativo])
  @@index([deletedAt])
  @@schema("magiclawyer")
}

// ============================================
// DADOS BANCÁRIOS
// ============================================

model DadosBancarios {
  id                String                @id @default(cuid())
  tenantId          String
  usuarioId         String? // NULL = dados do tenant/escritório
  clienteId         String? // NULL = dados do usuário/escritório
  tipoConta         TipoContaBancaria     @default(PESSOA_FISICA)
  bancoCodigo       String // Código do banco (ex: "001")
  agencia           String // Número da agência
  conta             String // Número da conta
  digitoConta       String? // Dígito da conta
  tipoContaBancaria TipoContaBancariaEnum @default(CORRENTE)
  chavePix          String? // Chave PIX (CPF, email, telefone, aleatória)
  tipoChavePix      TipoChavePix? // Tipo da chave PIX
  titularNome       String // Nome do titular
  titularDocumento  String // CPF/CNPJ do titular
  titularEmail      String? // Email do titular
  titularTelefone   String? // Telefone do titular
  endereco          String? // Endereço do titular
  cidade            String? // Cidade
  estado            String? // Estado (UF)
  cep               String? // CEP
  ativo             Boolean               @default(true)
  principal         Boolean               @default(false) // Conta principal
  observacoes       String? // Observações adicionais
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt
  deletedAt         DateTime?

  // Relacionamentos
  tenant     Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  usuario    Usuario?            @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  cliente    Cliente?            @relation(fields: [clienteId], references: [id], onDelete: Cascade)
  banco      Banco               @relation(fields: [bancoCodigo], references: [codigo])
  contratos  Contrato[]
  parcelas   ContratoParcela[]
  honorarios ContratoHonorario[]

  @@index([tenantId, usuarioId])
  @@index([tenantId, clienteId])
  @@index([tenantId, ativo])
  @@index([tenantId, principal])
  @@index([bancoCodigo])
  @@schema("magiclawyer")
}

// ============================================
// ENUMS PARA DADOS BANCÁRIOS
// ============================================

enum TipoContaBancaria {
  PESSOA_FISICA
  PESSOA_JURIDICA

  @@schema("magiclawyer")
}

enum TipoContaBancariaEnum {
  CORRENTE
  POUPANCA
  SALARIO
  INVESTIMENTO

  @@schema("magiclawyer")
}

enum TipoChavePix {
  CPF
  CNPJ
  EMAIL
  TELEFONE
  ALEATORIA

  @@schema("magiclawyer")
}

// ============================================
// CHECKOUT SESSIONS (Temporário)
// ============================================

model CheckoutSession {
  id              String   @id @default(cuid())
  dadosCheckout   Json // Dados do formulário de checkout
  planoId         String // ID do plano selecionado
  tenantSlug      String // Slug único do tenant
  tenantDomain    String // Domínio do tenant
  asaasCustomerId String // ID do cliente no Asaas
  asaasPaymentId  String // ID do pagamento no Asaas
  status          String   @default("PENDENTE") // PENDENTE, CONFIRMADO, ERRO
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([asaasPaymentId])
  @@index([status])
  @@schema("magiclawyer")
}

// ===== SISTEMA DE GESTÃO DE EQUIPE =====

model Cargo {
  id        String   @id @default(cuid())
  tenantId  String
  nome      String
  descricao String?
  nivel     Int      @default(1) // 1=Estagiário, 2=Assistente, 3=Advogado, 4=Coordenador, 5=Diretor
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamentos
  tenant     Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  usuarios   UsuarioCargo[]
  permissoes CargoPermissao[]
  convites   EquipeConvite[]

  @@index([tenantId])
  @@index([nome])
  @@schema("magiclawyer")
}

model CargoPermissao {
  id        String   @id @default(cuid())
  tenantId  String
  cargoId   String
  modulo    String // 'processos', 'clientes', 'advogados', 'financeiro', 'equipe', 'relatorios'
  acao      String // 'criar', 'editar', 'excluir', 'visualizar', 'exportar'
  permitido Boolean  @default(true)
  createdAt DateTime @default(now())

  // Relacionamentos
  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  cargo  Cargo  @relation(fields: [cargoId], references: [id], onDelete: Cascade)

  @@unique([tenantId, cargoId, modulo, acao])
  @@index([tenantId, cargoId])
  @@schema("magiclawyer")
}

model UsuarioCargo {
  id         String    @id @default(cuid())
  tenantId   String
  usuarioId  String
  cargoId    String
  ativo      Boolean   @default(true)
  dataInicio DateTime  @default(now())
  dataFim    DateTime?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  // Relacionamentos
  tenant  Tenant  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  usuario Usuario @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  cargo   Cargo   @relation(fields: [cargoId], references: [id], onDelete: Cascade)

  @@unique([tenantId, usuarioId, cargoId])
  @@index([tenantId, usuarioId])
  @@schema("magiclawyer")
}

model UsuarioPermissaoIndividual {
  id        String   @id @default(cuid())
  tenantId  String
  usuarioId String
  modulo    String // 'processos', 'clientes', 'advogados', 'financeiro', 'equipe', 'relatorios'
  acao      String // 'criar', 'editar', 'excluir', 'visualizar', 'exportar'
  permitido Boolean  @default(true)
  motivo    String? // Justificativa para a permissão individual
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamentos
  tenant  Tenant  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  usuario Usuario @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([tenantId, usuarioId, modulo, acao])
  @@index([tenantId, usuarioId])
  @@schema("magiclawyer")
}

model UsuarioVinculacao {
  id          String    @id @default(cuid())
  tenantId    String
  usuarioId   String // Usuário que serve (estagiário, controller, etc.)
  advogadoId  String // Advogado que é servido
  tipo        String // 'estagiario', 'controller', 'assistente', 'secretario'
  ativo       Boolean   @default(true)
  dataInicio  DateTime  @default(now())
  dataFim     DateTime?
  observacoes String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relacionamentos
  tenant   Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  usuario  Usuario  @relation("UsuarioServidor", fields: [usuarioId], references: [id], onDelete: Cascade)
  advogado Advogado @relation("UsuarioAdvogado", fields: [advogadoId], references: [id], onDelete: Cascade)

  @@unique([tenantId, usuarioId, advogadoId])
  @@index([tenantId, usuarioId])
  @@index([tenantId, advogadoId])
  @@schema("magiclawyer")
}

model EquipeHistorico {
  id           String   @id @default(cuid())
  tenantId     String
  usuarioId    String
  acao         String // 'criado', 'editado', 'cargo_alterado', 'permissao_alterada', 'vinculacao_alterada'
  dadosAntigos Json? // Dados antes da alteração
  dadosNovos   Json? // Dados após a alteração
  motivo       String? // Justificativa da alteração
  realizadoPor String // ID do usuário que fez a alteração
  createdAt    DateTime @default(now())

  // Relacionamentos
  tenant  Tenant  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  usuario Usuario @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@index([tenantId, usuarioId])
  @@index([tenantId, acao])
  @@schema("magiclawyer")
}

model EquipeConvite {
  id          String    @id @default(cuid())
  tenantId    String
  email       String
  nome        String?
  cargoId     String?
  role        UserRole  @default(ADVOGADO)
  token       String    @unique
  status      String    @default("pendente") // 'pendente', 'aceito', 'rejeitado', 'expirado'
  expiraEm    DateTime
  aceitoEm    DateTime?
  rejeitadoEm DateTime?
  observacoes String?
  enviadoPor  String // ID do usuário que enviou o convite
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relacionamentos
  tenant            Tenant  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  cargo             Cargo?  @relation(fields: [cargoId], references: [id], onDelete: SetNull)
  enviadoPorUsuario Usuario @relation(fields: [enviadoPor], references: [id], onDelete: Cascade)

  @@unique([tenantId, email])
  @@index([tenantId, status])
  @@index([token])
  @@index([expiraEm])
  @@schema("magiclawyer")
}
